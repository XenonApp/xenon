{"version":3,"sources":["../../src/js/goto.js"],"names":["eventbus","require","symbol","ui","editor","session_manager","fs","command","fuzzyfind","locator","fileCache","filteredFileCache","globalLastEditPoint","declare","api","hook","on","updateFilteredFileCache","session","setTimeout","cursor","selection","getCursor","path","indexOf","push","i","splice","init","setupCommands","fetchFileList","getFileCache","getFileListKnownTypes","modes","filter","getModeForPath","hint","phrase","results","_","escape","substring","length","console","log","listFiles","then","files","Object","keys","specialDocs","forEach","emit","err","error","Promise","reject","escapeRegExp","str","replace","wildcardToRegexp","excludes","getPreference","watch","regex","RegExp","map","join","exec","define","doc","edit","text","undefined","currentPos","getCursorPosition","selectionRange","getSelectionRange","filterSymbols","getSymbols","prefix","limit","symbols","symbolList","t","parts","split","name","meta","icon","type","score","sessions","getSessions","resultsPromise","phraseParts","parse","originalPhrase","loc","filename","resolve","toLowerCase","file","fileNorm","lastUse","resultList","Infinity","filterPromise","result","all","matchLists","concat","editors","getEditors","getSession","sort","r1","r2","filterBox","placeholder","currentPath","onChange","selectedItem","jump","onSelect","fileOnly","$cmdInfo","go","onCancel","isFocused","$mouseHandler","isMousePressed","switchSession","moveCursorToPosition","clearSelection","readOnly","moveCursorTo","row","column","getPathUnderCursor","ident","getIdentifierUnderCursor","module","exports"],"mappings":"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","file":"goto.js","sourcesContent":["'use strict';\n\nconst eventbus = require('./eventbus');\nconst symbol = require('./symbol');\nconst ui = require('./ui');\nconst editor = require('./editor');\nconst session_manager = require('./session_manager');\nconst fs = require('./fs');\nconst command = require('./command');\n\nvar fuzzyfind = require(\"./lib/fuzzyfind\");\nvar locator = require(\"./lib/locator\");\n\nvar fileCache = [];\nvar filteredFileCache = [];\nvar globalLastEditPoint;\n\neventbus.declare(\"loadedfilelist\");\neventbus.declare(\"goto\");\n\nvar api = {\n    hook: function() {\n        eventbus.on(\"configchanged\", function() {\n            updateFilteredFileCache();\n        });\n        eventbus.on(\"sessionchanged\", function(session) {\n            // set timeout so that the edit has been appplied already\n            setTimeout(function() {\n                globalLastEditPoint = {\n                    session: session,\n                    cursor: session.selection.getCursor()\n                };\n            });\n        });\n\n        fs.on('add', (path) => {\n            if (fileCache.indexOf(path) === -1) {\n                fileCache.push(path);\n                filteredFileCache.push(path);\n            }\n        });\n\n        fs.on('unlink', (path) => {\n            let i = fileCache.indexOf(path);\n            if (i > -1) {\n                fileCache.splice(i, 1);\n            }\n\n            i = filteredFileCache.indexOf(path);\n            if (i > -1) {\n                filteredFileCache.splice(i, 1);\n            }\n        });\n    },\n    init: function() {\n        setupCommands();\n        fetchFileList();\n    },\n    fetchFileList: fetchFileList,\n    getFileCache: function() {\n        return filteredFileCache;\n    },\n    getFileListKnownTypes: function() {\n        var modes = require(\"./modes\");\n        return filteredFileCache.filter(function(path) {\n            return modes.getModeForPath(path);\n        });\n    }\n};\n\nfunction hint(phrase, results) {\n    if (phrase[0] === ':') {\n        if (phrase === \":\") {\n            return \"Type line number and press <tt>Enter</tt> to jump.\";\n        } else if (phrase == \":/\") {\n            return \"Type search phrase and press <tt>Enter</tt> to jump to first match.\";\n        } else if (phrase == \":|\") {\n            return \"Type search phrase(case insensitive) and press <tt>Enter</tt> to jump to first match.\";\n        } else if (phrase[1] === '/') {\n            return \"<tt>Enter</tt> jumps to first match for '\" + _.escape(phrase.substring(2)) + \"'\";\n        } else if (phrase == \":@\") {\n            return \"Type symbol name and press <tt>Enter</tt> to jump to it.\";\n        } else if (phrase[1] === '@') {\n            return \"<tt>Enter</tt> jumps to first definition of '\" + _.escape(phrase.substring(2)) + \"'\";\n        } else {\n            return \"<tt>Enter</tt> jumps to line \" + phrase.substring(1);\n        }\n    } else if (phrase[0] === \"@\") {\n        if (phrase === \"@\") {\n            return \"Type symbol name to jump to within this project.\";\n        } else {\n            return \"<tt>Enter</tt> jumps to the first symbol matching your query.\";\n        }\n    } else if(phrase[0] === \"#\") {\n        if(phrase === \"#\") {\n            return \"Type a phrase to search the project for\";\n        } else {\n            return \"<tt>Enter</tt> will start a project search.\";\n        }\n    } else if (phrase && (results.length === 0 || phrase[0] === \"/\")) {\n        return \"<tt>Return</tt> creates and/or opens this file.\";\n    } else {\n        return \"<tt>Return</tt> opens the selected file.\";\n    }\n}\n\nfunction fetchFileList() {\n    console.log(\"Fetching file list...\");\n    return fs.listFiles().then(function(files) {\n        fileCache = files;\n        Object.keys(session_manager.specialDocs).forEach(function(path) {\n            fileCache.push(path);\n        });\n        updateFilteredFileCache();\n        eventbus.emit(\"loadedfilelist\");\n    }, function(err) {\n        console.error(\"Error listing files\", err);\n        return Promise.reject(err);\n    });\n}\n\nfunction escapeRegExp(str) {\n    return str.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\");\n}\n\nfunction wildcardToRegexp(str) {\n    str = escapeRegExp(str);\n    str = str.replace(/\\\\\\*/g, \".*\");\n    return \"^\" + str + \"$\";\n}\n\nfunction updateFilteredFileCache() {\n    var excludes = require(\"./config\").getPreference(\"gotoExclude\");\n    fs.watch(excludes);\n    if (!excludes || excludes.length === 0) {\n        filteredFileCache = fileCache;\n        return;\n    }\n    var regex = new RegExp(excludes.map(wildcardToRegexp).join(\"|\"));\n    filteredFileCache = fileCache.filter(function(path) {\n        return !regex.exec(path);\n    });\n}\n\nfunction setupCommands() {\n    command.define(\"Navigate:Goto\", {\n        doc: \"Prompts for the name of a file to edit, opening and creating it if necessary.\",\n        exec: function(edit, session, text) {\n            if (typeof text !== \"string\") {\n                text = undefined;\n            }\n            var currentPos = edit.getCursorPosition();\n            var selectionRange = edit.getSelectionRange();\n\n            function filterSymbols(phrase, path) {\n                return symbol.getSymbols({\n                    prefix: phrase.substring(1),\n                    path: path,\n                    limit: 250\n                }).then(function(symbols) {\n                    var symbolList = symbols.map(function(t) {\n                        var parts = t.path.split(\"/\");\n                        return {\n                            name: t.symbol,\n                            path: t.path + \":\" + t.locator,\n                            meta: parts[parts.length - 1],\n                            icon: t.type,\n                            score: 1\n                        };\n                    });\n                    return symbolList;\n                });\n            }\n\n            function filter(phrase) {\n                var sessions = session_manager.getSessions();\n                var resultsPromise;\n                var phraseParts = locator.parse(phrase);\n                var originalPhrase = phrase;\n                phrase = phraseParts[0];\n                var loc = phraseParts[1];\n\n                if (!phrase && loc !== undefined) {\n                    if (loc[0] === \"@\") {\n                        resultsPromise = filterSymbols(loc, session.filename);\n                    } else {\n                        resultsPromise = Promise.resolve([]);\n                    }\n                } else if (phrase[0] === \"@\") {\n                    resultsPromise = filterSymbols(phrase);\n                } else if (phrase[0] === \"#\") {\n                    resultsPromise = Promise.resolve([]);\n                } else if (phrase[0] === '/') {\n                    var results = {};\n                    phrase = phrase.toLowerCase();\n                    filteredFileCache.forEach(function(file) {\n                        var fileNorm = file.toLowerCase();\n                        var score = 1;\n\n                        if (sessions[file]) {\n                            score = sessions[file].lastUse;\n                        }\n\n                        if (fileNorm.substring(0, phrase.length) === phrase) {\n                            results[file] = score;\n                        }\n                    });\n                    var resultList = [];\n                    if (fileCache.indexOf(phrase) === -1 && \":@#\".indexOf(phrase[0]) === -1) {\n                        resultList.push({\n                            path: phrase,\n                            name: \"Create file '\" + originalPhrase + \"'\",\n                            score: Infinity,\n                            icon: \"action\"\n                        });\n                    }\n                    Object.keys(results).forEach(function(path) {\n                        resultList.push({\n                            path: path,\n                            name: path,\n                            score: results[path],\n                            icon: \"file\"\n                        });\n                    });\n                    resultsPromise = Promise.resolve(resultList);\n                } else {\n                    // Regular file path goto\n                    var filterPromise = new Promise(function(resolve, reject) {\n                        var resultList = fuzzyfind(filteredFileCache, phrase);\n                        resultList.forEach(function(result) {\n                            result.name = result.path;\n                            if (sessions[result.path]) {\n                                result.score += sessions[result.path].lastUse / 100000000;\n                            }\n                            result.icon = \"file\";\n                        });\n                        resolve(resultList);\n                    });\n                    resultsPromise = Promise.all([filterSymbols(\"@\" + phrase), filterPromise]).then(function(matchLists) {\n                        return matchLists[1].concat(matchLists[0]);\n                    });\n                }\n\n                return resultsPromise.then(function(resultList) {\n                    var editors = editor.getEditors();\n\n                    // Filter out paths currently open in an editor\n                    resultList.forEach(function(result) {\n                        for (var i = 0; i < editors.length; i++) {\n                            if (editors[i].getSession().filename === result.path) {\n                                result.score = 0;\n                            }\n                        }\n                    });\n\n                    resultList.sort(function(r1, r2) {\n                        if (r1.score === r2.score) {\n                            if(r1.icon === \"file\") {\n                                // In case of files shorter is better\n                                return r1.path.length - r2.path.length;\n                            } else {\n                                // In case of the rest, just sort by path\n                                return r1.path < r2.path ? -1 : 1;\n                            }\n                        } else {\n                            return r2.score - r1.score;\n                        }\n                    });\n\n                    if (resultList.length === 0 && loc === undefined && \":@#\".indexOf(phrase[0]) === -1) {\n                        resultList = [{\n                            path: phrase,\n                            name: \"Create file '\" + originalPhrase + \"'\",\n                            icon: \"action\"\n                        }];\n                    } else if (phrase[0] === \"#\") {\n                        resultList = [{\n                            path: phrase,\n                            name: \"Project search: \" + originalPhrase.substring(1),\n                            icon: \"action\"\n                        }];\n                    }\n                    return resultList;\n                });\n            }\n\n            // TODO: Clean this up, has gotten messy over time\n            ui.filterBox({\n                placeholder: \"Path\",\n                filter: filter,\n                text: text,\n                currentPath: session.filename,\n                onChange: function(phrase, selectedItem) {\n                    var phraseParts = locator.parse(phrase);\n                    var loc = phraseParts[1];\n                    if (loc && (!phraseParts[0] || phraseParts[0] === session.filename)) {\n                        locator.jump(loc, selectionRange, selectedItem);\n                    }\n                },\n                hint: hint,\n                onSelect: function(file, phrase) {\n                    var currentPath = session.filename;\n                    var fileOnly, loc, phraseParts;\n                    phraseParts = locator.parse(phrase);\n                    if (file !== phrase) {\n                        loc = phraseParts[1];\n                        fileOnly = file || currentPath;\n                    } else {\n                        fileOnly = phraseParts[0] || currentPath;\n                        loc = phraseParts[1];\n                    }\n\n                    if(phrase[0] === \"#\") {\n                        session.$cmdInfo = {\n                            phrase: phrase.substring(1)\n                        };\n                        command.exec(\"Find:Find In Project Internal\", edit, session);\n                        return;\n                    }\n                    // Actual jumping only needs to happen if it's non-local\n                    // i.e. if we're not already there (as is the case with local locators)\n                    if ((phraseParts[0] || !loc) && \":@#\".indexOf(fileOnly[0]) === -1) {\n                        file = fileOnly + (loc ? ':' + loc : '');\n                        session_manager.go(file, edit, session);\n                    }\n                    eventbus.emit(\"goto\", phrase);\n                },\n                onCancel: function() {\n                    // do not cancel if user have clicked on the editor\n                    if (edit.isFocused() && edit.$mouseHandler.isMousePressed)\n                        return;\n                    editor.switchSession(session, edit);\n                    edit.moveCursorToPosition(currentPos);\n                    edit.clearSelection();\n                }\n            });\n        },\n        readOnly: true\n    });\n\n    command.define(\"Navigate:Reload Filelist\", {\n        doc: \"Scan the project tree for any new files that were created outside of Zed.\",\n        exec: fetchFileList,\n        readOnly: true\n    });\n\n    command.define(\"Navigate:Last Edit Point\", {\n        exec: function(edit, session) {\n            if(globalLastEditPoint) {\n                session_manager.go(globalLastEditPoint.session.filename, edit, session).then(function(session) {\n                    session.selection.moveCursorTo(globalLastEditPoint.cursor.row, globalLastEditPoint.cursor.column);\n                    session.selection.clearSelection();\n                });\n            }\n        },\n        readOnly: true\n    });\n\n    command.define(\"Find:Find In Project\", {\n        doc: \"Search the project.\",\n        exec: function(edit, session) {\n            command.exec(\"Navigate:Goto\", edit, session, \"#\");\n        },\n        readOnly: true\n    });\n\n    command.define(\"Navigate:Path Under Cursor\", {\n        doc: \"Open the filename indicated by the cursor.\",\n        exec: function(edit, session) {\n            var path = editor.getPathUnderCursor();\n            command.exec(\"Navigate:Goto\", edit, session, path);\n        },\n        readOnly: true\n    });\n\n    command.define(\"Navigate:Lookup Symbol\", {\n        doc: \"Prompts you for a symbol to search for in this project.\",\n        exec: function(edit, session) {\n            command.exec(\"Navigate:Goto\", edit, session, \"@\");\n        },\n        readOnly: true\n    });\n\n    command.define(\"Navigate:Lookup Symbol In File\", {\n        doc: \"Prompts you for a symbol to search for just within the current file.\",\n        exec: function(edit, session) {\n            command.exec(\"Navigate:Goto\", edit, session, \":@\");\n        },\n        readOnly: true\n    });\n\n    command.define(\"Navigate:Lookup Symbol Under Cursor\", {\n        doc: \"Searches for the word at your cursor within this project.\",\n        exec: function(edit, session) {\n            var ident = editor.getIdentifierUnderCursor();\n            command.exec(\"Navigate:Goto\", edit, session, \"@\" + ident);\n        },\n        readOnly: true\n    });\n}\n\n\nmodule.exports = api;\n"]}