{"version":3,"sources":["../../src/js/mac_cli_command.nw.js"],"names":["define","require","exports","module","plugin","consumes","options","imports","register","command","ui","process","platform","setupInstallCliCommand","gui","nodeRequire","rootMenu","Menu","type","createMacBuiltin","toolsMenu","toolsMenuItem","MenuItem","label","submenu","append","click","installTools","Window","get","menu","doc","exec","readOnly","path","fs","applicationPath","dirname","execPath","prompt","message","then","yes","HOME","env","rcFile","existsSync","appendFileSync","e"],"mappings":"AAAA;AACA;;AAEAA,OAAO,UAASC,OAAT,EAAkBC,OAAlB,EAA2BC,MAA3B,EAAmC;AACtCC,WAAOC,QAAP,GAAkB,CAAC,SAAD,EAAY,IAAZ,CAAlB;AACA,WAAOD,MAAP;;AAEA,aAASA,MAAT,CAAgBE,OAAhB,EAAyBC,OAAzB,EAAkCC,QAAlC,EAA4C;AACxC,YAAIC,UAAUF,QAAQE,OAAtB;AACA,YAAIC,KAAKH,QAAQG,EAAjB;;AAEA,YAAIC,QAAQC,QAAR,KAAqB,QAAzB,EAAmC;AAC/BC;AACH;;AAEDL;;AAEA,iBAASK,sBAAT,GAAkC;AAC9B,gBAAIC,MAAMC,YAAY,QAAZ,CAAV;;AAEA,gBAAIC,WAAW,IAAIF,IAAIG,IAAR,CAAa;AACxBC,sBAAM;AADkB,aAAb,CAAf;AAGA,gBAAGF,SAASG,gBAAZ,EAA8B;AAC1BH,yBAASG,gBAAT,CAA0B,KAA1B;AACH;AACD,gBAAIC,YAAY,IAAIN,IAAIG,IAAR,EAAhB;AACA,gBAAII,gBAAgB,IAAIP,IAAIQ,QAAR,CAAiB;AACjCC,uBAAO,OAD0B;AAEjCC,yBAASJ;AAFwB,aAAjB,CAApB;AAIAA,sBAAUK,MAAV,CAAiB,IAAIX,IAAIQ,QAAR,CAAiB;AAC9BC,uBAAO,mBADuB;AAE9BG,uBAAO,YAAW;AACdC;AACH;AAJ6B,aAAjB,CAAjB;AAMAX,qBAASS,MAAT,CAAgBJ,aAAhB;AACAP,gBAAIc,MAAJ,CAAWC,GAAX,GAAiBC,IAAjB,GAAwBd,QAAxB;;AAEAP,oBAAQT,MAAR,CAAe,uBAAf,EAAwC;AACpC+B,qBAAK,yEAD+B;AAEpCC,sBAAML,YAF8B;AAGpCM,0BAAU;AAH0B,aAAxC;AAKH;;AAED,iBAASN,YAAT,GAAwB;AACpB,gBAAIO,OAAOnB,YAAY,MAAZ,CAAX;AACA,gBAAIoB,KAAKpB,YAAY,IAAZ,CAAT;AACA,gBAAIqB,kBAAkBF,KAAKG,OAAL,CAAaH,KAAKG,OAAL,CAAaH,KAAKG,OAAL,CAAaH,KAAKG,OAAL,CAAaH,KAAKG,OAAL,CAAaH,KAAKG,OAAL,CAAa1B,QAAQ2B,QAArB,CAAb,CAAb,CAAb,CAAb,CAAb,CAAtB;;AAEA5B,eAAG6B,MAAH,CAAU;AACNC,yBAAS;AADH,aAAV,EAEGC,IAFH,CAEQ,UAASC,GAAT,EAAc;AAClB,oBAAG,CAACA,GAAJ,EAAS;AACL;AACH;AACD;AACA,oBAAIC,OAAOhC,QAAQiC,GAAR,CAAYD,IAAvB;AACA,oBAAIE,SAASF,OAAO,WAApB;AACA,oBAAIR,GAAGW,UAAH,CAAcH,OAAO,gBAArB,CAAJ,EAA4C;AACxCE,6BAASF,OAAO,gBAAhB;AACH,iBAFD,MAEO,IAAIR,GAAGW,UAAH,CAAcH,OAAO,UAArB,CAAJ,EAAsC;AACzCE,6BAASF,OAAO,UAAhB;AACH;AACD,oBAAI;AACAR,uBAAGY,cAAH,CAAkBF,MAAlB,EAA0B,qBAAqBT,eAArB,GAAuC,gBAAjE;AACA1B,uBAAG6B,MAAH,CAAU;AACNC,iCAAS;AADH,qBAAV;AAGH,iBALD,CAKE,OAAOQ,CAAP,EAAU;AACRtC,uBAAG6B,MAAH,CAAU;AACNC,iCAAS,wBAAwBK;AAD3B,qBAAV;AAGH;AACJ,aAxBD;AAyBH;AACJ;AACJ,CA5ED","file":"mac_cli_command.nw.js","sourcesContent":["'use strict';\n//TODO: fix mac cli\n\ndefine(function(require, exports, module) {\n    plugin.consumes = [\"command\", \"ui\"];\n    return plugin;\n\n    function plugin(options, imports, register) {\n        var command = imports.command;\n        var ui = imports.ui;\n\n        if (process.platform === \"darwin\") {\n            setupInstallCliCommand();\n        }\n\n        register();\n\n        function setupInstallCliCommand() {\n            var gui = nodeRequire(\"nw.gui\");\n\n            var rootMenu = new gui.Menu({\n                type: 'menubar'\n            });\n            if(rootMenu.createMacBuiltin) {\n                rootMenu.createMacBuiltin(\"Zed\");\n            }\n            var toolsMenu = new gui.Menu();\n            var toolsMenuItem = new gui.MenuItem({\n                label: 'Tools',\n                submenu: toolsMenu\n            });\n            toolsMenu.append(new gui.MenuItem({\n                label: \"Install CLI Tools\",\n                click: function() {\n                    installTools();\n                }\n            }));\n            rootMenu.append(toolsMenuItem);\n            gui.Window.get().menu = rootMenu;\n\n            command.define(\"Tools:Install Mac CLI\", {\n                doc: \"Installs command-line tools for Mac to launch Zed from the command line\",\n                exec: installTools,\n                readOnly: true\n            });\n        }\n\n        function installTools() {\n            var path = nodeRequire(\"path\");\n            var fs = nodeRequire(\"fs\");\n            var applicationPath = path.dirname(path.dirname(path.dirname(path.dirname(path.dirname(path.dirname(process.execPath))))));\n\n            ui.prompt({\n                message: \"This will extend your ~/.profile, ~/.bash_profile, or ~/.bashrc PATH variable to include Zed. Proceed?\"\n            }).then(function(yes) {\n                if(!yes) {\n                    return;\n                }\n                // Determine startup file to add to\n                var HOME = process.env.HOME;\n                var rcFile = HOME + \"/.profile\";\n                if (fs.existsSync(HOME + \"/.bash_profile\")) {\n                    rcFile = HOME + \"/.bash_profile\";\n                } else if (fs.existsSync(HOME + \"/.bashrc\")) {\n                    rcFile = HOME + \"/.bashrc\";\n                }\n                try {\n                    fs.appendFileSync(rcFile, \"\\nexport PATH=\\\"\" + applicationPath + \"/bin\\\":$PATH\\n\");\n                    ui.prompt({\n                        message: \"Installed! Open a fresh terminal and start using the 'zed' command!\"\n                    });\n                } catch (e) {\n                    ui.prompt({\n                        message: \"Could not write to \" + rcFile\n                    });\n                }\n            });\n        }\n    }\n});\n"]}