{"version":3,"sources":["../../../src/js/lib/autocomplete.js"],"names":["ID_REGEX","HashHandler","global","ace","require","AcePopup","util","event","lang","snippetManager","Autocomplete","autoInsert","autoSelect","keyboardHandler","bindKeys","commands","blurListener","bind","changeListener","mousedownListener","mousewheelListener","changeTimer","delayedCall","updateCompletions","gatherCompletionsId","$init","popup","document","body","documentElement","on","e","insertMatch","stop","focus","editor","openPopup","prefix","keepPopupPosition","setData","completions","filtered","renderer","setRow","setTheme","getTheme","setFontSize","getFontSize","lineHeight","layerConfig","pos","$cursorLayer","getPixelPosition","base","left","getTextLeftOffset","rect","container","getBoundingClientRect","top","offset","scrollLeft","$gutterLayer","gutterWidth","show","detach","keyBinding","removeKeyboardHandler","off","cancel","isOpen","hide","activated","cursor","selection","lead","row","column","line","session","getLine","insertedCh","exec","schedule","el","activeElement","textInput","getElement","parentNode","goTo","where","getRow","max","getLength","data","getData","completer","filterText","ranges","getAllRanges","i","range","start","length","remove","snippet","insertSnippet","execCommand","value","insert","result","tabstopManager","gotoPageUp","gotoPageDown","gatherCompletions","callback","getSession","getCursorPosition","retrievePrecedingIdentifier","matches","total","completers","forEach","getCompletions","err","results","concat","finished","showPopup","addKeyboardHandler","_id","doDetach","indexOf","FilteredList","setFilter","cancelContextMenu","domEvent","stopEvent","setTimeout","call","prototype","startCommand","name","bindKey","array","all","str","lastIndexOf","filterCompletions","sort","a","b","score","prev","filter","item","caption","items","needle","upper","toUpperCase","lower","toLowerCase","loop","lastIndex","matchMask","penalty","index","distance","j","i1","i2","exactMatch","push","module","exports"],"mappings":"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","file":"autocomplete.js","sourcesContent":["/* ***** BEGIN LICENSE BLOCK *****\n * Distributed under the BSD license:\n *\n * Copyright (c) 2012, Ajax.org B.V.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *     * Redistributions of source code must retain the above copyright\n *       notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above copyright\n *       notice, this list of conditions and the following disclaimer in the\n *       documentation and/or other materials provided with the distribution.\n *     * Neither the name of Ajax.org B.V. nor the\n *       names of its contributors may be used to endorse or promote products\n *       derived from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * ***** END LICENSE BLOCK ******/\n\n\"use strict\";\n\nvar ID_REGEX = /[a-zA-Z_0-9\\$-]|[^\\u0000-\\u007F]/;\n\nvar HashHandler = global.ace.require(\"ace/keyboard/hash_handler\").HashHandler;\nvar AcePopup = require(\"./ace_popup\").AcePopup;\nvar util = global.ace.require(\"ace/autocomplete/util\");\nvar event = global.ace.require(\"ace/lib/event\");\nvar lang = global.ace.require(\"ace/lib/lang\");\nvar snippetManager = global.ace.require(\"ace/snippets\").snippetManager;\n\nvar Autocomplete = function() {\n    this.autoInsert = true;\n    this.autoSelect = true;\n    this.keyboardHandler = new HashHandler();\n    this.keyboardHandler.bindKeys(this.commands);\n\n    this.blurListener = this.blurListener.bind(this);\n    this.changeListener = this.changeListener.bind(this);\n    this.mousedownListener = this.mousedownListener.bind(this);\n    this.mousewheelListener = this.mousewheelListener.bind(this);\n\n    this.changeTimer = lang.delayedCall(function() {\n        this.updateCompletions(true);\n    }.bind(this))\n};\n\n(function() {\n    this.gatherCompletionsId = 0;\n\n    this.$init = function() {\n        this.popup = new AcePopup(document.body || document.documentElement);\n        this.popup.on(\"click\", function(e) {\n            this.insertMatch();\n            e.stop();\n        }.bind(this));\n        this.popup.focus = this.editor.focus.bind(this.editor);\n    };\n\n    this.openPopup = function(editor, prefix, keepPopupPosition) {\n        if (!this.popup)\n            this.$init();\n\n        this.popup.setData(this.completions.filtered);\n\n        var renderer = editor.renderer;\n        this.popup.setRow(this.autoSelect ? 0 : -1);\n        if (!keepPopupPosition) {\n            this.popup.setTheme(editor.getTheme());\n            this.popup.setFontSize(editor.getFontSize());\n\n            var lineHeight = renderer.layerConfig.lineHeight;\n\n            var pos = renderer.$cursorLayer.getPixelPosition(this.base, true);\n            pos.left -= this.popup.getTextLeftOffset();\n            pos.left -= 16;\n\n            var rect = editor.container.getBoundingClientRect();\n            pos.top += rect.top - renderer.layerConfig.offset;\n            pos.left += rect.left - editor.renderer.scrollLeft;\n            pos.left += renderer.$gutterLayer.gutterWidth;\n\n            this.popup.show(pos, lineHeight);\n        } else if(keepPopupPosition && !prefix) {\n            this.detach();\n        }\n    };\n\n    this.detach = function() {\n        this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler);\n        this.editor.off(\"changeSelection\", this.changeListener);\n        this.editor.off(\"blur\", this.blurListener);\n        this.editor.off(\"mousedown\", this.mousedownListener);\n        this.editor.off(\"mousewheel\", this.mousewheelListener);\n        this.changeTimer.cancel();\n\n        if (this.popup && this.popup.isOpen) {\n            this.gatherCompletionsId = this.gatherCompletionsId + 1;\n        }\n\n        if (this.popup)\n            this.popup.hide();\n\n        this.activated = false;\n        this.completions = this.base = null;\n    };\n\n    this.changeListener = function(e) {\n        var cursor = this.editor.selection.lead;\n        if (cursor.row != this.base.row || cursor.column < this.base.column) {\n            return this.detach();\n        }\n        var line = this.editor.session.getLine(cursor.row);\n        var insertedCh = line[cursor.column-1];\n        if(!ID_REGEX.exec(insertedCh)) {\n            return this.detach();\n        }\n        if (this.activated)\n            this.changeTimer.schedule();\n        else\n            this.detach();\n    };\n\n    this.blurListener = function() {\n        // we have to check if activeElement is a child of popup because\n        // on IE preventDefault doesn't stop scrollbar from being focussed\n        var el = document.activeElement;\n        if (el != this.editor.textInput.getElement() && el.parentNode != this.popup.container)\n            this.detach();\n    };\n\n    this.mousedownListener = function(e) {\n        this.detach();\n    };\n\n    this.mousewheelListener = function(e) {\n        this.detach();\n    };\n\n    this.goTo = function(where) {\n        var row = this.popup.getRow();\n        var max = this.popup.session.getLength() - 1;\n\n        switch(where) {\n            case \"up\": row = row <= 0 ? max : row - 1; break;\n            case \"down\": row = row >= max ? 0 : row + 1; break;\n            case \"start\": row = 0; break;\n            case \"end\": row = max; break;\n        }\n\n        this.popup.setRow(row);\n    };\n\n    this.insertMatch = function(data) {\n        if (!data)\n            data = this.popup.getData(this.popup.getRow());\n        if (!data)\n            return false;\n\n        if (data.completer && data.completer.insertMatch) {\n            data.completer.insertMatch(this.editor);\n        } else {\n            if (this.completions.filterText) {\n                var ranges = this.editor.selection.getAllRanges();\n                for (var i = 0, range; range = ranges[i]; i++) {\n                    range.start.column -= this.completions.filterText.length;\n                    this.editor.session.remove(range);\n                }\n            }\n            if (data.snippet)\n                snippetManager.insertSnippet(this.editor, data.snippet);\n            else\n                this.editor.execCommand(\"insertstring\", data.value || data);\n        }\n        this.detach();\n    };\n\n    this.commands = {\n        \"Up\": function(editor) { editor.completer.goTo(\"up\"); },\n        \"Down\": function(editor) { editor.completer.goTo(\"down\"); },\n        \"Ctrl-Up|Ctrl-Home\": function(editor) { editor.completer.goTo(\"start\"); },\n        \"Ctrl-Down|Ctrl-End\": function(editor) { editor.completer.goTo(\"end\"); },\n\n        \"Esc\": function(editor) { editor.completer.detach(); },\n        \"Space\": function(editor) { editor.completer.detach(); editor.insert(\" \");},\n        \"Return\": function(editor) { return editor.completer.insertMatch(); },\n        \"Shift-Return\": function(editor) { editor.completer.insertMatch(true); },\n        \"Tab\": function(editor) {\n            var result = editor.completer.insertMatch();\n            if (!result && !editor.tabstopManager)\n                editor.completer.goTo(\"down\");\n            else\n                return result;\n        },\n\n        \"PageUp\": function(editor) { editor.completer.popup.gotoPageUp(); },\n        \"PageDown\": function(editor) { editor.completer.popup.gotoPageDown(); }\n    };\n\n    this.gatherCompletions = function(editor, callback) {\n        var session = editor.getSession();\n        var pos = editor.getCursorPosition();\n\n        var line = session.getLine(pos.row);\n        var prefix = util.retrievePrecedingIdentifier(line, pos.column);\n\n        this.base = editor.getCursorPosition();\n        this.base.column -= prefix.length;\n\n        var matches = [];\n        var total = editor.completers.length;\n        editor.completers.forEach(function(completer, i) {\n            completer.getCompletions(editor, session, pos, prefix, function(err, results) {\n                if (!err)\n                    matches = matches.concat(results);\n                // Fetch prefix again, because they may have changed by now\n                var pos = editor.getCursorPosition();\n                var line = session.getLine(pos.row);\n                callback(null, {\n                    prefix: util.retrievePrecedingIdentifier(line, pos.column, ID_REGEX),\n                    matches: matches,\n                    finished: (--total === 0)\n                });\n            });\n        });\n        return true;\n    };\n\n    this.showPopup = function(editor) {\n        if (this.editor)\n            this.detach();\n\n        this.activated = true;\n\n        this.editor = editor;\n        if (editor.completer != this) {\n            if (editor.completer)\n                editor.completer.detach();\n            editor.completer = this;\n        }\n\n        editor.keyBinding.addKeyboardHandler(this.keyboardHandler);\n        editor.on(\"changeSelection\", this.changeListener);\n        editor.on(\"blur\", this.blurListener);\n        editor.on(\"mousedown\", this.mousedownListener);\n        editor.on(\"mousewheel\", this.mousewheelListener);\n\n        this.updateCompletions();\n    };\n\n    this.updateCompletions = function(keepPopupPosition) {\n        var _id = this.gatherCompletionsId;\n        this.gatherCompletions(this.editor, function(err, results) {\n            // Only detach if result gathering is finished\n            var doDetach = function() {\n                if (!results.finished) return;\n                return this.detach();\n            }.bind(this);\n\n\n            var prefix = results.prefix;\n            var matches = results && results.matches;\n\n            if (!matches || !matches.length)\n                return doDetach();\n\n            // Wrong prefix or wrong session -> ignore\n            if (prefix.indexOf(results.prefix) != 0 || _id != this.gatherCompletionsId)\n                return;\n\n            this.completions = new FilteredList(matches);\n            this.completions.setFilter(prefix);\n            var filtered = this.completions.filtered;\n\n            // No results\n            if (!filtered.length)\n                return doDetach();\n\n            // One result equals to the prefix\n            if (filtered.length == 1 && filtered[0].value == prefix && !filtered[0].snippet)\n                return doDetach();\n\n            // Autoinsert if one result\n            if (this.autoInsert && filtered.length == 1 && !keepPopupPosition)\n                return this.insertMatch(filtered[0]);\n\n            this.openPopup(this.editor, prefix, keepPopupPosition);\n        }.bind(this));\n    };\n\n    this.cancelContextMenu = function() {\n        var stop = function(e) {\n            this.editor.off(\"nativecontextmenu\", stop);\n            if (e && e.domEvent)\n                event.stopEvent(e.domEvent);\n        }.bind(this);\n        setTimeout(stop, 10);\n        this.editor.on(\"nativecontextmenu\", stop);\n    };\n\n}).call(Autocomplete.prototype);\n\nAutocomplete.startCommand = {\n    name: \"startAutocomplete\",\n    exec: function(editor) {\n        if (!editor.completer)\n            editor.completer = new Autocomplete();\n        editor.completer.autoInsert =\n        editor.completer.autoSelect = true;\n        editor.completer.showPopup(editor);\n        // needed for firefox on mac\n        editor.completer.cancelContextMenu();\n    },\n    bindKey: \"Ctrl-Space|Ctrl-Shift-Space|Alt-Space\"\n};\n\nvar FilteredList = function(array, filterText) {\n    this.all = array;\n    this.filtered = array;\n    this.filterText = filterText || \"\";\n};\n(function(){\n    this.setFilter = function(str) {\n        var matches;\n        if (str.length > this.filterText && str.lastIndexOf(this.filterText, 0) === 0)\n            matches = this.filtered;\n        else\n            matches = this.all;\n\n        this.filterText = str;\n        matches = this.filterCompletions(matches, this.filterText);\n        matches = matches.sort(function(a, b) {\n            return b.score - a.score;\n        });\n\n        // make unique\n        var prev = null;\n        matches = matches.filter(function(item){\n            var caption = item.value || item.caption || item.snippet;\n            if (caption === prev) return false;\n            prev = caption;\n            return true;\n        });\n\n        this.filtered = matches;\n    };\n    this.filterCompletions = function(items, needle) {\n        var results = [];\n        var upper = needle.toUpperCase();\n        var lower = needle.toLowerCase();\n        loop: for (var i = 0, item; item = items[i]; i++) {\n            var caption = item.value || item.caption || item.snippet;\n            if (!caption) continue;\n            var lastIndex = -1;\n            var matchMask = 0;\n            var penalty = 0;\n            var index, distance;\n            // caption char iteration is faster in Chrome but slower in Firefox, so lets use indexOf\n            for (var j = 0; j < needle.length; j++) {\n                // TODO add penalty on case mismatch\n                var i1 = caption.indexOf(lower[j], lastIndex + 1);\n                var i2 = caption.indexOf(upper[j], lastIndex + 1);\n                index = (i1 >= 0) ? ((i2 < 0 || i1 < i2) ? i1 : i2) : i2;\n                if (index < 0)\n                    continue loop;\n                distance = index - lastIndex - 1;\n                if (distance > 0) {\n                    // first char mismatch should be more sensitive\n                    if (lastIndex === -1)\n                        penalty += 10;\n                    penalty += distance;\n                }\n                matchMask = matchMask | (1 << index);\n                lastIndex = index;\n            }\n            item.matchMask = matchMask;\n            item.exactMatch = penalty ? 0 : 1;\n            item.score = (item.score || 0) - penalty;\n            results.push(item);\n        }\n        return results;\n    };\n}).call(FilteredList.prototype);\n\nmodule.exports.Autocomplete = Autocomplete;\nmodule.exports.FilteredList = FilteredList;\n"]}