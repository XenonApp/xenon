{"version":3,"sources":["../../../src/js/lib/filter_list.js"],"names":["keyCode","require","module","exports","options","inputEl","resultsEl","list","onSelect","onUpdate","onCancel","onDelete","lastFilterPhrase","val","selectIdx","getFilteredList","filterPhrase","toLowerCase","filter","p","section","name","indexOf","getFilteredListLength","count","forEach","update","filtered","empty","idx","item","el","$","text","append","data","html","key","addClass","updateSelection","noScroll","els","find","removeClass","selectedEl","eq","length","scrollIntoView","keyUpHandler","keyHandler","event","click","preventDefault","notInList","cleanup","Math","max","min","shiftKey","stopPropagation","altKey","console","log","filteredItems","charCodeAt","clickHandler","info","target","off","mouseOverHandler","keyup","on","keydown"],"mappings":"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","file":"filter_list.js","sourcesContent":["var keyCode = require(\"./key_code\");\n\n/**\n * - inputEl\n * - resultsEl\n * - list // {name: ..., html: ...}\n * - onSelect\n * - onUpdate\n * - onCancel\n * - onDelete\n */\nmodule.exports = function(options) {\n    var inputEl = options.inputEl;\n    var resultsEl = options.resultsEl;\n    var list = options.list;\n    var onSelect = options.onSelect;\n    var onUpdate = options.onUpdate;\n    var onCancel = options.onCancel;\n    var onDelete = options.onDelete;\n\n    var lastFilterPhrase = inputEl.val();\n\n    var selectIdx = 0;\n\n    function getFilteredList() {\n        var filterPhrase = inputEl.val().toLowerCase();\n        return list.filter(function(p) {\n            if (p.section) {\n                return true;\n            }\n            return p.name.toLowerCase().indexOf(filterPhrase) !== -1;\n        });\n    }\n\n    function getFilteredListLength() {\n        var count = 0;\n        var filterPhrase = inputEl.val().toLowerCase();\n        list.forEach(function(p) {\n            if (p.section) {\n                return;\n            }\n            if (p.name.toLowerCase().indexOf(filterPhrase) !== -1) {\n                count++;\n            }\n        });\n        return count;\n    }\n\n    function update() {\n        var filtered = getFilteredList();\n\n        resultsEl.empty();\n        var idx = 0;\n        filtered.forEach(function(item) {\n            var el;\n            if (item.section) {\n                el = $(\"<div class='section'>\");\n                el.text(item.section);\n                resultsEl.append(el);\n            } else {\n                el = $(\"<a href='#'>\");\n                el.data(\"info\", item);\n                var html = item.html;\n                if(item.key) {\n                    html += '<span class=\"meta\">Alt-' + item.key + '</span>';\n                }\n                el.html(html);\n                el.data(\"idx\", idx);\n                if (idx === selectIdx) {\n                    el.addClass(\"active\");\n                }\n                resultsEl.append(el);\n                idx++;\n            }\n        });\n\n        onUpdate && onUpdate();\n    }\n\n    function updateSelection(noScroll) {\n        var els = resultsEl.find(\"a\");\n        els.removeClass(\"active\");\n        var selectedEl = els.eq(selectIdx);\n        if (selectedEl.length > 0) {\n            selectedEl.addClass(\"active\");\n            if (!noScroll) {\n                selectedEl[0].scrollIntoView(false);\n            }\n        }\n    }\n\n    function keyUpHandler() {\n        if (lastFilterPhrase != inputEl.val()) {\n            selectIdx = 0;\n            lastFilterPhrase = inputEl.val();\n            update();\n        }\n    }\n\n    function keyHandler(event) {\n        var selectedEl;\n        switch (event.keyCode) {\n            case keyCode('Return'):\n                selectedEl = resultsEl.find(\"a\").eq(selectIdx);\n                if (selectedEl.length > 0) {\n                    selectedEl.click();\n                    // inputEl.val(\"\");\n                    // update();\n                    event.preventDefault();\n                } else {\n                    onSelect({\n                        name: inputEl.val(),\n                        notInList: true\n                    });\n                    cleanup();\n                }\n                break;\n            case keyCode('PgUp'):\n                selectIdx = Math.max(0, selectIdx - 10);\n                break;\n            case keyCode('Up'):\n                selectIdx = Math.max(0, selectIdx - 1);\n                break;\n            case keyCode('Down'):\n                selectIdx = Math.min(getFilteredListLength() - 1, selectIdx + 1);\n                break;\n            case keyCode('PgDown'):\n                selectIdx = Math.min(getFilteredListLength() - 1, selectIdx + 10);\n                break;\n            case keyCode('Tab'):\n                if (event.shiftKey) {\n                    // Up\n                    selectIdx = Math.max(0, selectIdx - 1);\n                } else {\n                    // Down\n                    selectIdx = Math.min(getFilteredList().length - 1, selectIdx + 1);\n                }\n                event.preventDefault();\n                event.stopPropagation();\n                break;\n            case keyCode('Esc'):\n                inputEl.val(\"\");\n                update();\n                onCancel && onCancel();\n                cleanup();\n                break;\n            case keyCode('Delete'):\n                selectedEl = resultsEl.find(\"a\").eq(selectIdx);\n                onDelete && onDelete(selectedEl.data(\"info\"));\n                update();\n                break;\n        }\n        if(event.altKey) {\n            console.log(\"Key\", event);\n            var filteredItems = getFilteredList();\n            filteredItems.forEach(function(item) {\n                console.log(item);\n                if(item.key && item.key.charCodeAt(0) === event.keyCode) {\n                    cleanup();\n                    onSelect(item);\n                }\n            });\n        }\n        updateSelection();\n    }\n\n    function clickHandler(event) {\n        var info = $(event.target).data(\"info\");\n        cleanup();\n        onSelect(info);\n    }\n\n    function cleanup() {\n        $(\"body\").off(\"keydown\", keyHandler);\n        resultsEl.off(\"click\", \"a\", clickHandler);\n        resultsEl.off(\"mouseover\", \"a\", mouseOverHandler);\n        inputEl.off(\"keyup\", keyUpHandler);\n    }\n\n    function mouseOverHandler(event) {\n        var idx = $(event.target).data(\"idx\");\n        selectIdx = idx;\n        updateSelection(true);\n    }\n\n    inputEl.keyup(keyUpHandler);\n    resultsEl.on(\"click\", \"a\", clickHandler);\n    resultsEl.on(\"mouseover\", \"a\", mouseOverHandler);\n    $(\"body\").keydown(keyHandler);\n\n    update();\n};\n"]}