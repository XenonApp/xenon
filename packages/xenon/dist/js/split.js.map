{"version":3,"sources":["../../src/js/split.js"],"names":["eventbus","require","state","editor","command","config","declare","api","hook","on","get","splitOne","splitTwo","splitThree","emit","getActiveEditor","updateActiveEditorStyling","updateActiveEditorStylingOnConfigChange","resetEditorDiv","switchSplit","el","attr","split","forEach","cls","substring","length","removeClass","set","activeEditor","newActiveEditor","getEditors","swapSession","session","$","addClass","setActiveEditor","resizeEditors","style","undefined","currentSplit","indexOf","parseInt","edit","resize","editors","idx","dimInactiveEditors","getPreference","newDimInactiveEditors","container","define","doc","exec","readOnly","allEditors","visibleEditors","switchSession","module","exports"],"mappings":"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","file":"split.js","sourcesContent":["\"use strict\";\n/**\n * This module implements Zed's split views, it supports the following types of splits\n * - 1 split (full window)\n * - 2 vertical splits (with 3 variants: 50-50%, 33-66% and 66-33%)\n * - 3 vertical splits\n * - 2 vertical split with left one code editor and right one preview panel (handled in preview.js)\n */\n \nconst eventbus = require('./eventbus');\nconst state = require('./state');\nconst editor = require('./editor');\nconst command = require('./command');\nconst config = require('./config');\n\n/**\n * Triggered when the active editor has changed\n * @param edit the new active editor\n */\neventbus.declare(\"splitswitched\");\n\n/**\n * Triggered when the split configuration has changed\n * @param config (1, 2, 3 or preview)\n */\neventbus.declare(\"splitchange\");\n\nvar api = {\n    hook: function() {\n        eventbus.on(\"stateloaded\", function() {\n            if (!state.get(\"split\")) {\n                return splitOne();\n            }\n            switch (state.get(\"split\")) {\n                case \"1\":\n                    splitOne();\n                    break;\n                case \"2-0\":\n                    splitTwo(0);\n                    break;\n                case \"2-1\":\n                    splitTwo(1);\n                    break;\n                case \"2-2\":\n                    splitTwo(2);\n                    break;\n                case \"3\":\n                    splitThree();\n                    break;\n            }\n            eventbus.emit(\"splitswitched\", editor.getActiveEditor());\n        });\n\n        eventbus.on(\"splitswitched\", updateActiveEditorStyling);\n        eventbus.on(\"configchanged\", updateActiveEditorStylingOnConfigChange);\n    },\n    resetEditorDiv: resetEditorDiv,\n    switchSplit: switchSplit,\n};\n\nfunction resetEditorDiv(el) {\n    el.attr(\"class\").split(/\\s+/).forEach(function(cls) {\n        if (cls.substring(0, \"editor-\".length) === \"editor-\") {\n            el.removeClass(cls);\n        }\n    });\n    return el;\n}\n\nfunction splitOne() {\n    state.set(\"split\", \"1\");\n    var activeEditor = editor.getActiveEditor();\n    var newActiveEditor = editor.getEditors(true)[0];\n    // If the editor left is not the one that is currently active\n    // swap the two sessions\n    if(activeEditor !== newActiveEditor) {\n        swapSession(activeEditor, activeEditor.session, 0);\n    }\n    resetEditorDiv($(\"#editor0\")).addClass(\"editor-single\");\n    resetEditorDiv($(\"#editor1\")).addClass(\"editor-disabled\");\n    resetEditorDiv($(\"#editor2\")).addClass(\"editor-disabled\");\n    editor.setActiveEditor(newActiveEditor);\n    resizeEditors();\n    eventbus.emit(\"splitchange\", \"1\");\n    eventbus.emit(\"splitswitched\", newActiveEditor);\n}\n\nfunction splitTwo(style) {\n    if (style === undefined) {\n        var currentSplit = \"\" + state.get(\"split\") || \"1\";\n        if (currentSplit.indexOf(\"2-\") === 0) {\n            // Increase by one\n            style = (parseInt(currentSplit.substring(2), 10) + 1) % 3;\n        } else {\n            style = 0;\n        }\n    }\n    state.set(\"split\", \"2-\" + style);\n    resetEditorDiv($(\"#editor0\")).addClass(\"editor-vsplit2-left-\" + style);\n    resetEditorDiv($(\"#editor1\")).addClass(\"editor-vsplit2-right-\" + style);\n    resetEditorDiv($(\"#editor2\")).addClass(\"editor-disabled\");\n    var edit = editor.getEditors(true)[1];\n    editor.setActiveEditor(edit);\n    resizeEditors();\n    eventbus.emit(\"splitchange\", \"2-\" + style);\n    eventbus.emit(\"splitswitched\", edit);\n}\n\nfunction splitThree() {\n    state.set(\"split\", \"3\");\n    resetEditorDiv($(\"#editor0\")).addClass(\"editor-vsplit3-left\");\n    resetEditorDiv($(\"#editor1\")).addClass(\"editor-vsplit3-middle\");\n    resetEditorDiv($(\"#editor2\")).addClass(\"editor-vsplit3-right\");\n    var edit = editor.getEditors(true)[2];\n    editor.setActiveEditor(edit);\n    resizeEditors();\n    eventbus.emit(\"splitchange\", \"3\");\n    eventbus.emit(\"splitswitched\", edit);\n}\n\nfunction resizeEditors() {\n    editor.getEditors().forEach(function(editor) {\n        editor.resize();\n    });\n}\n\nfunction switchSplit() {\n    var editors = editor.getEditors();\n    var activeEditor = editor.getActiveEditor();\n    var idx = editors.indexOf(activeEditor);\n    activeEditor = editors[(idx + 1) % editors.length];\n    editor.setActiveEditor(activeEditor);\n    eventbus.emit(\"splitswitched\", activeEditor);\n}\n\nvar dimInactiveEditors = config.getPreference(\"dimInactiveEditors\");\n\nfunction updateActiveEditorStylingOnConfigChange() {\n    var newDimInactiveEditors = config.getPreference(\"dimInactiveEditors\");\n    if (newDimInactiveEditors !== dimInactiveEditors) {\n        dimInactiveEditors = newDimInactiveEditors;\n        if (dimInactiveEditors) {\n            updateActiveEditorStyling();\n        } else {\n            editor.getEditors().forEach(function(edit) {\n                $(edit.container).removeClass(\"inactive-editor\");\n            });\n        }\n    }\n}\n\nfunction updateActiveEditorStyling() {\n    if (dimInactiveEditors) {\n        var activeEditor = editor.getActiveEditor();\n        editor.getEditors().forEach(function(edit) {\n            if (edit === activeEditor) {\n                $(edit.container).removeClass(\"inactive-editor\");\n            } else {\n                $(edit.container).addClass(\"inactive-editor\");\n            }\n        });\n    }\n}\n\ncommand.define(\"Split:One\", {\n    doc: \"Show only a single editor pane.\",\n    exec: splitOne,\n    readOnly: true\n});\n\ncommand.define(\"Split:Vertical Two\", {\n    doc: \"Show two editor panes.\",\n    exec: function() {\n        splitTwo();\n    },\n    readOnly: true\n});\n\ncommand.define(\"Split:Vertical Three\", {\n    doc: \"Show three editor panes.\",\n    exec: splitThree,\n    readOnly: true\n});\n\ncommand.define(\"Split:Switch Focus\", {\n    doc: \"Move the active cursor to the next editor pane.\",\n    exec: switchSplit,\n    readOnly: true\n});\n\nfunction swapSession(edit, session, idx) {\n    var allEditors = editor.getEditors(true);\n    var visibleEditors = editor.getEditors();\n    var activeEditor = editor.getActiveEditor();\n    if (idx >= visibleEditors.length) {\n        if (idx === 1) {\n            splitTwo();\n        } else { // idx == 3\n            splitThree();\n        }\n    }\n    editor.switchSession(allEditors[idx].session, activeEditor);\n    editor.switchSession(session, allEditors[idx]);\n    editor.setActiveEditor(allEditors[idx]);\n}\n\ncommand.define(\"Split:Move To First\", {\n    exec: function(edit, session) {\n        swapSession(edit, session, 0);\n    },\n    readOnly: true\n});\ncommand.define(\"Split:Move To Second\", {\n    exec: function(edit, session) {\n        swapSession(edit, session, 1);\n    },\n    readOnly: true\n});\ncommand.define(\"Split:Move To Third\", {\n    exec: function(edit, session) {\n        swapSession(edit, session, 2);\n    },\n    readOnly: true\n});\n\nmodule.exports = api;\n"]}