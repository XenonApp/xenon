{"version":3,"sources":["../../src/js/boot.js"],"names":["global","ace","config","set","path","require","WEBPACK","window","isNodeWebkit","options","introText","readFileSync","join","__dirname","encoding","baseModules","editor","eventbus","history","openUI","session_manager","tracker","ui","cache","localStore","get","then","xeddConfig","configDir","url","xedd","openConfig","load","console","log","openUrl","projectPicker","modules","slice","boot","err","error","removeProject","prompt","message","bootEditor","$","remove","_","each","service","hook","init","trackEvent","split","setupBuiltinDoc","on","text","session","createSession","readOnly","modesLoaded","modes","setSessionMode","removeListener","specialDocs"],"mappings":"AAAA;;AAEAA,OAAOC,GAAP,CAAWC,MAAX,CAAkBC,GAAlB,CAAsB,UAAtB,EAAkC,2CAAlC;AACAH,OAAOC,GAAP,CAAWC,MAAX,CAAkBC,GAAlB,CAAsB,UAAtB,EAAkC,2CAAlC;AACAH,OAAOC,GAAP,CAAWC,MAAX,CAAkBC,GAAlB,CAAsB,WAAtB,EAAmC,2CAAnC;AACA,MAAMC,OAAOC,QAAQ,MAAR,CAAb;;AAEA,IAAI,OAAOC,OAAP,KAAmB,WAAvB,EAAoC;AAChCN,WAAOM,OAAP,GAAiB,KAAjB;AACH;;AAEDC,OAAOC,YAAP,GAAsB,IAAtB;;AAEA,MAAMC,UAAUJ,QAAQ,eAAR,CAAhB;;AAEA,IAAIK,SAAJ;AACA,IAAIJ,OAAJ,EAAa;AACTI,gBAAYL,QAAQ,oBAAR,CAAZ;AACH,CAFD,MAEO;AACHK,gBAAYL,QAAQ,IAAR,EACPM,YADO,CACMP,KAAKQ,IAAL,CAAUC,SAAV,EAAqB,IAArB,EAA2B,QAA3B,EAAqC,UAArC,CADN,EACwD,EAACC,UAAU,OAAX,EADxD,CAAZ;AAEH;;AAED,IAAIC,WAAJ,EAAiBC,MAAjB,EAAyBC,QAAzB,EAAmCC,OAAnC,EAA4CC,MAA5C,EAAoDC,eAApD,EAAqEC,OAArE,EAA8EC,EAA9E;;AAEA,MAAMC,QAAQlB,QAAQ,SAAR,CAAd;AACA,MAAMmB,aAAanB,QAAQ,eAAR,CAAnB;;AAEA,IAAIC,OAAJ,EAAa;AACTkB,eAAWC,GAAX,CAAe,YAAf,EAA6BC,IAA7B,CAAkC,MAAOC,UAAP,IAAsB;AACpD,cAAMC,YAAY,MAAMJ,WAAWC,GAAX,CAAe,WAAf,CAAxB;AACA,YAAI,CAACE,UAAD,IAAe,CAACA,WAAWE,GAA3B,IAAkC,CAACD,SAAvC,EAAkD;AAC9C,kBAAME,OAAOzB,QAAQ,YAAR,CAAb;AACAyB,iBAAKC,UAAL,GAAkBL,IAAlB,CAAuB,MAAOE,SAAP,IAAqB;AACxC,sBAAMJ,WAAWrB,GAAX,CAAe,WAAf,EAA4ByB,SAA5B,CAAN;AACAL,sBAAMpB,GAAN,CAAU,WAAV,EAAuByB,SAAvB;AACAI;AACH,aAJD;AAKH,SAPD,MAOO;AACHT,kBAAMpB,GAAN,CAAU,YAAV,EAAwBwB,UAAxB;AACAJ,kBAAMpB,GAAN,CAAU,WAAV,EAAuByB,SAAvB;AACAI;AACH;AACJ,KAdD;AAeH,CAhBD,MAgBO;AACHA;AACH;;AAED,SAASA,IAAT,GAAgB;AACZjB,kBAAc,CACVE,WAAWZ,QAAQ,YAAR,CADD,EAEViB,KAAKjB,QAAQ,MAAR,CAFK,EAGVA,QAAQ,WAAR,CAHU,EAIVW,SAASX,QAAQ,UAAR,CAJC,EAKVA,QAAQ,aAAR,CALU,EAMVA,QAAQ,UAAR,CANU,EAOVA,QAAQ,UAAR,CAPU,EAQVA,QAAQ,QAAR,CARU,EASVA,QAAQ,QAAR,CATU,EAUVA,QAAQ,SAAR,CAVU,EAWVA,QAAQ,WAAR,CAXU,EAYVA,QAAQ,QAAR,CAZU,EAaVA,QAAQ,YAAR,CAbU,EAcVe,kBAAkBf,QAAQ,mBAAR,CAdR,EAeVA,QAAQ,SAAR,CAfU,EAgBVA,QAAQ,SAAR,CAhBU,EAiBVA,QAAQ,QAAR,CAjBU,EAkBVA,QAAQ,WAAR,CAlBU,EAmBVA,QAAQ,OAAR,CAnBU,EAoBVA,QAAQ,YAAR,CApBU,EAqBVA,QAAQ,UAAR,CArBU,EAsBVA,QAAQ,SAAR,CAtBU;AAuBV;AACAA,YAAQ,mBAAR,CAxBU,EAyBVA,QAAQ,aAAR,CAzBU,EA0BVC,UAAU2B,QAAQC,GAAR,CAAY,iCAAZ,CAAV,GAA2D7B,QAAQ,QAAR,CA1BjD,EA2BVA,QAAQ,MAAR,CA3BU,EA4BVA,QAAQ,cAAR,CA5BU,EA6BVA,QAAQ,aAAR,CA7BU,EA8BVc,SAASd,QAAQ,WAAR,CA9BC;AA+BV;AACAa,cAAUb,QAAQ,WAAR,CAhCA,EAiCVA,QAAQ,eAAR,CAjCU;AAkCV;AACAA,YAAQ,aAAR,CAnCU,EAoCVA,QAAQ,UAAR,CApCU,EAqCVgB,UAAUhB,QAAQ,qBAAR,CArCA,EAsCVA,QAAQ,YAAR,CAtCU,EAuCVA,QAAQ,MAAR,CAvCU,EAwCVC,UAAU2B,QAAQC,GAAR,CAAY,gCAAZ,CAAV,GAA0D7B,QAAQ,SAAR;AAC1D;AACA;AA1CU,KAAd;;AA6CA,QAAII,QAAQgB,GAAR,CAAY,KAAZ,CAAJ,EAAwB;AACpBU,gBAAQ1B,QAAQgB,GAAR,CAAY,KAAZ,CAAR;AACH,KAFD,MAEO;AACHW;AACH;AACJ;;AAED,SAASA,aAAT,GAAyB;AACrB,QAAIC,UAAUtB,YAAYuB,KAAZ,EAAd;AACAC,SAAKF,OAAL,EAAc,KAAd;AACAlB,WAAOoB,IAAP;AACH;;AAEDhC,OAAO6B,aAAP,GAAuBA,aAAvB;;AAEA,SAASD,OAAT,CAAiBN,GAAjB,EAAsB;AAClB,QAAIQ,UAAUtB,YAAYuB,KAAZ,EAAd;;AAEA,QAAI;AACAC,aAAKF,OAAL,EAAc,IAAd;AACH,KAFD,CAEE,OAAOG,GAAP,EAAY;AACVP,gBAAQQ,KAAR,CAAcD,GAAd;AACA,YAAIH,UAAUtB,YAAYuB,KAAZ,EAAd;AACAC,aAAKF,OAAL,EAAc,KAAd;AACA;AACAnB,gBAAQwB,aAAR,CAAsBb,GAAtB;AACAP,WAAGqB,MAAH,CAAU;AACNC,qBAAS;AADH,SAAV,EAEGlB,IAFH,CAEQU,aAFR;AAGH;AACJ;;AAGD,SAASG,IAAT,CAAcF,OAAd,EAAuBQ,UAAvB,EAAmC;AAC/BC,MAAE,KAAF,EAASC,MAAT;AACAD,MAAE,MAAF,EAAUC,MAAV;AACAD,MAAE,SAAF,EAAaC,MAAb;AACA;AACA;AACA;AACAC,MAAEC,IAAF,CAAOlC,WAAP,EAAoB,UAASmC,OAAT,EAAkB;AAClC,YAAIA,WAAWA,QAAQC,IAAvB,EAA6B;AACzBD,oBAAQC,IAAR;AACH;AACJ,KAJD;AAKA;AACAH,MAAEC,IAAF,CAAOlC,WAAP,EAAoB,UAASmC,OAAT,EAAkB;AAClC,YAAIA,WAAWA,QAAQE,IAAvB,EAA6B;AACzBF,oBAAQE,IAAR;AACH;AACJ,KAJD;;AAMA,QAAIP,UAAJ,EAAgB;AACZxB,gBAAQK,IAAR,CAAaL,WAAWA,QAAQgC,UAAR,CAAmB,QAAnB,EAA6B,cAA7B,EAA6C5C,QAAQgB,GAAR,CAAY,KAAZ,EAAmB6B,KAAnB,CAAyB,GAAzB,EAA8B,CAA9B,CAA7C,CAAxB;;AAEAC,wBAAgB,YAAhB,EAA8B7C,SAA9B;AACA6C,wBAAgB,UAAhB,EAA4B,wBAA5B;AAEH,KAND,MAMO;AACHtC,iBAASuC,EAAT,CAAY,YAAZ,EAA0B,YAAW;AACjCrB,oBAAQ1B,QAAQgB,GAAR,CAAY,KAAZ,CAAR;AACH,SAFD;AAGH;;AAEDQ,YAAQC,GAAR,CAAY,aAAZ;;AAEA,aAASqB,eAAT,CAAyBnD,IAAzB,EAA+BqD,IAA/B,EAAqC;AACjC,YAAIC,UAAU1C,OAAO2C,aAAP,CAAqBvD,IAArB,EAA2BqD,IAA3B,CAAd;AACAC,gBAAQE,QAAR,GAAmB,IAAnB;;AAEA3C,iBAASuC,EAAT,CAAY,aAAZ,EAA2B,SAASK,WAAT,CAAqBC,KAArB,EAA4B;AACnD,gBAAIA,MAAMrC,GAAN,CAAU,UAAV,CAAJ,EAA2B;AACvBqC,sBAAMC,cAAN,CAAqBL,OAArB,EAA8B,UAA9B;AACAzC,yBAAS+C,cAAT,CAAwB,aAAxB,EAAuCH,WAAvC;AACH;AACJ,SALD;;AAOAzC,wBAAgB6C,WAAhB,CAA4B7D,IAA5B,IAAoCsD,OAApC;AACH;AACJ","file":"boot.js","sourcesContent":["'use strict';\n\nglobal.ace.config.set('basePath', '../node_modules/ace-builds/src-noconflict');\nglobal.ace.config.set('modePath', '../node_modules/ace-builds/src-noconflict');\nglobal.ace.config.set('themePath', '../node_modules/ace-builds/src-noconflict');\nconst path = require('path');\n\nif (typeof WEBPACK === 'undefined') {\n    global.WEBPACK = false;\n}\n\nwindow.isNodeWebkit = true;\n\nconst options = require('./lib/options');\n\nlet introText;\nif (WEBPACK) {\n    introText = require('../manual/intro.md');\n} else {\n    introText = require('fs')\n        .readFileSync(path.join(__dirname, '..', 'manual', 'intro.md'), {encoding: 'utf-8'});\n}\n\nlet baseModules, editor, eventbus, history, openUI, session_manager, tracker, ui;\n\nconst cache = require('./cache');\nconst localStore = require('./local_store');\n\nif (WEBPACK) {\n    localStore.get('xeddConfig').then(async (xeddConfig) => {\n        const configDir = await localStore.get('configDir');\n        if (!xeddConfig || !xeddConfig.url || !configDir) {\n            const xedd = require('./xedd.jsx');\n            xedd.openConfig().then(async (configDir) => {\n                await localStore.set('configDir', configDir);\n                cache.set('configDir', configDir);\n                load()\n            });\n        } else {\n            cache.set('xeddConfig', xeddConfig);\n            cache.set('configDir', configDir);\n            load();\n        }\n    });\n} else {\n    load();\n}\n\nfunction load() {\n    baseModules = [\n        eventbus = require('./eventbus'),\n        ui = require('./ui'),\n        require(\"./command\"),\n        editor = require(\"./editor\"),\n        require(\"./title_bar\"),\n        require(\"./symbol\"),\n        require(\"./config\"),\n        require(\"./goto\"),\n        require(\"./tree\"),\n        require(\"./state\"),\n        require(\"./project\"),\n        require(\"./keys\"),\n        require(\"./complete\"),\n        session_manager = require(\"./session_manager\"),\n        require(\"./modes\"),\n        require(\"./split\"),\n        require(\"./file\"),\n        require(\"./preview\"),\n        require(\"./dnd\"),\n        require(\"./handlers\"),\n        require(\"./action\"),\n        require(\"./theme\"),\n        // require(\"./log\"),\n        require(\"./window_commands\"),\n        require(\"./analytics\"),\n        WEBPACK ? console.log('chrome app does not have a menu') : require(\"./menu\"),\n        require(\"./db\"),\n        require(\"./webservers\"),\n        require(\"./sandboxes\"),\n        openUI = require(\"./open_ui\"),\n        // require(\"./background\"),\n        history = require(\"./history\"),\n        require(\"./local_store\"),\n        // require(\"./sandbox\"),\n        require(\"./webserver\"),\n        require(\"./window\"),\n        tracker = require(\"./analytics_tracker\"),\n        require(\"./configfs\"),\n        require('./fs'),\n        WEBPACK ? console.log('chrome app does not have xenpm') : require('./xenpm')\n        // \"./mac_cli_command.nw\",\n        // \"./cli.nw\"\n    ];\n\n    if (options.get(\"url\")) {\n        openUrl(options.get(\"url\"));\n    } else {\n        projectPicker();\n    }\n}\n\nfunction projectPicker() {\n    var modules = baseModules.slice();\n    boot(modules, false);\n    openUI.boot();\n}\n\nwindow.projectPicker = projectPicker;\n\nfunction openUrl(url) {\n    var modules = baseModules.slice();\n\n    try {\n        boot(modules, true);\n    } catch (err) {\n        console.error(err);\n        var modules = baseModules.slice();\n        boot(modules, false);\n        // Remove this project from history\n        history.removeProject(url);\n        ui.prompt({\n            message: \"Project not longer accessible by Zed. Will now return to project picker.\"\n        }).then(projectPicker);\n    }\n}\n\n\nfunction boot(modules, bootEditor) {\n    $(\"div\").remove();\n    $(\"span\").remove();\n    $(\"webview\").remove();\n    // $(\"body\").append(\"<img src='/icons/Icon.png' id='wait-logo'>\");\n    // $(\"#wait-logo\").remove();\n    // Run hook on each service (if exposed)\n    _.each(baseModules, function(service) {\n        if (service && service.hook) {\n            service.hook();\n        }\n    });\n    // Run init on each service (if exposed)\n    _.each(baseModules, function(service) {\n        if (service && service.init) {\n            service.init();\n        }\n    });\n\n    if (bootEditor) {\n        tracker.then(tracker => tracker.trackEvent(\"Editor\", \"FsTypeOpened\", options.get(\"url\").split(\":\")[0]));\n\n        setupBuiltinDoc(\"zed::start\", introText);\n        setupBuiltinDoc(\"zed::log\", \"Zed Log\\n===========\\n\");\n\n    } else {\n        eventbus.on(\"urlchanged\", function() {\n            openUrl(options.get(\"url\"));\n        });\n    }\n\n    console.log(\"App started\");\n\n    function setupBuiltinDoc(path, text) {\n        var session = editor.createSession(path, text);\n        session.readOnly = true;\n\n        eventbus.on(\"modesloaded\", function modesLoaded(modes) {\n            if (modes.get(\"markdown\")) {\n                modes.setSessionMode(session, \"markdown\");\n                eventbus.removeListener(\"modesloaded\", modesLoaded);\n            }\n        });\n\n        session_manager.specialDocs[path] = session;\n    }\n}\n"]}