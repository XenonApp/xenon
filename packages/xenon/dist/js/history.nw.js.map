{"version":3,"sources":["../../src/js/history.nw.js"],"names":["module","exports","api","pushProject","name","url","setTimeout","pushIt","require","console","log","projects","JSON","parse","localStorage","recentProjects","e","config","length","existing","_","where","splice","loadConfiguration","then","getPreference","numToRemove","stringify","indexOf","renameProject","project","findWhere","Promise","resolve","removeProject","filter","lookupProjectByUrl","getProjects","addProjectChangeListener","listener","window","addEventListener"],"mappings":"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","file":"history.nw.js","sourcesContent":["module.exports = function () {\n    var api = {\n        pushProject: function(name, url) {\n            // Using setTimeout to wait for the whole architect app to the initialized\n            // kind of hacky, but ok\n            setTimeout(function pushIt() {\n                if(!require(\"./config\")) {\n                    console.log(\"Not yet...\");\n                    return setTimeout(pushIt, 500);\n                }\n                console.log(\"Pushing project\", name, url);\n                var projects;\n                try {\n                    projects = JSON.parse(localStorage.recentProjects);\n                } catch (e) {\n                    projects = [];\n                }\n                var config = require(\"./config\");\n                // sanity check projects array\n                if (projects.length > 0 && !projects[0].url) {\n                    projects = [];\n                }\n                var existing = _.where(projects, {\n                    url: url\n                });\n                if (existing.length === 0) {\n                    projects.splice(0, 0, {\n                        name: name,\n                        url: url\n                    });\n                    config.loadConfiguration().then(function() {\n                        if (projects.length > config.getPreference(\"recentFolderHistory\")) {\n                            var numToRemove = projects.length - config.getPreference(\"recentFolderHistory\");\n                            projects.splice(projects.length - numToRemove, numToRemove);\n                        }\n                        localStorage.recentProjects = JSON.stringify(projects);\n                    });\n                } else {\n                    projects.splice(projects.indexOf(existing[0]), 1);\n                    projects.splice(0, 0, {\n                        name: existing[0].name,\n                        url: url\n                    });\n                    localStorage.recentProjects = JSON.stringify(projects);\n                }\n            }, 500);\n        },\n        renameProject: function(url, name) {\n            var projects;\n            try {\n                projects = JSON.parse(localStorage.recentProjects);\n            } catch (e) {\n                projects = [];\n            }\n            var project = _.findWhere(projects, {\n                url: url\n            });\n            project.name = name;\n            localStorage.recentProjects = JSON.stringify(projects);\n            return Promise.resolve();\n        },\n        removeProject: function(url) {\n            var projects;\n            console.log(\"Deleting\", url);\n            try {\n                projects = JSON.parse(localStorage.recentProjects);\n            } catch (e) {\n                projects = [];\n            }\n            console.log(\"All projects\", projects);\n            projects = _.filter(projects, function(project) {\n                return project.url !== url;\n            });\n            localStorage.recentProjects = JSON.stringify(projects);\n            return Promise.resolve();\n        },\n        lookupProjectByUrl: function(url) {\n            return api.getProjects().then(function(projects) {\n                var project = _.findWhere(projects, {\n                    url: url\n                });\n                return project;\n            });\n        },\n        getProjects: function() {\n            var projects;\n            try {\n                projects = JSON.parse(localStorage.recentProjects);\n            } catch (e) {\n                projects = [];\n            }\n            return Promise.resolve(projects);\n        },\n        addProjectChangeListener: function(listener) {\n            window.addEventListener('storage', listener, false);\n        }\n    };\n    return api;\n};\n"]}