{"version":3,"sources":["../../src/js/editor.js"],"names":["eventbus","require","command","config","fs","modes","sandboxes","whitespace","global","ace","font","IDENT_REGEX","PATH_REGEX","declare","editors","activeEditor","api","hook","on","setTimeout","updateConfiguration","edit","session","setEditorConfiguration","setSessionConfiguration","path","forEach","getSession","filename","go","$","append","setHighlightActiveLine","getPreference","setHighlightGutterLine","setFontSize","setShowPrintMargin","setPrintMarginColumn","setShowInvisibles","setDisplayIndentGuides","setOption","setAnimatedScroll","setShowFoldWidgets","setScrollSpeed","renderer","setShowGutter","setHighlightSelectedWord","setBehavioursEnabled","setWrapBehavioursEnabled","fontFamily","isInstalled","container","css","emit","removeAllListeners","e","autoIndentOnPaste","setKeyboardHandler","vim","emacs","zed","setTabSize","setUseSoftTabs","setUseWrapMode","setWrapLimitRange","getEditors","session_manager","sessions","_","values","getSessions","concat","specialDocs","each","init","set","setDefaultValue","push","editor","$blockScrolling","Infinity","setTheme","cssClass","cssText","$cursorLayer","setSmoothBlinking","saveSession","setActiveEditor","createSession","content","createEditSession","mode","getModeForSession","setUseWorker","setSessionMode","detectIndentation","switchSession","getActiveEditor","prevSession","setSession","setReadOnly","readOnly","isInsertingSnippet","tabstopManager","isEmpty","focus","all","filter","is","resizeEditors","resize","getActiveSession","getSessionState","undoStack","getUndoManager","$undoStack","slice","redoStack","$redoStack","scrollTop","getScrollTop","scrollLeft","getScrollLeft","selection","getSelection","getRange","lastUse","undo","redo","setSessionState","state","setSelectionRange","setScrollTop","setScrollLeft","undoManager","$doc","getIdentifierUnderCursor","regex","getTextRange","getIdentifierUnderCursorRange","Range","cursor","getCursorPosition","line","getLine","row","test","column","startCol","endCol","length","getPathUnderCursor","pos","getSelectionRange","start","tabSize","col","i","tabAsSpaces","text","replace","lines","split","regexp","min","index","search","adjust","substring","add","join","RegExp","find","needle","dir","Search","$options","wrap","caseSensitive","wholeWord","backwards","selectMore","sel","multiSelect","range","toOrientedRange","newRange","end","addRange","define","doc","exec","toggleFold","foldAll","unfold","selectUp","multiSelectAction","selectAll","scrollIntoView","clearSelection","selectFileEnd","selectDown","selectWordLeft","selectLineStart","selectLeft","selectWordRight","selectLineEnd","selectRight","selectPageDown","jumpToMatching","selectPageUp","selectFileStart","duplicateSelection","args","navigateUp","times","navigateDown","navigateFileStart","navigateFileEnd","navigateWordLeft","navigateWordRight","navigateLineStart","navigateLeft","navigateLineEnd","navigateRight","gotoPageDown","gotoPageUp","centerSelection","selectMoreLines","alignCursors","scrollPageDown","scrollPageUp","scrollBy","layerConfig","lineHeight","commands","toggleRecording","replay","removeLines","toggleCommentLines","modifyNumber","copyLinesUp","moveLinesUp","copyLinesDown","moveLinesDown","remove","removeToLineStart","removeToLineEnd","blockOutdent","indent","blockIndent","splitLine","transposeLetters","transposeSelections","toUpperCase","toLowerCase","removeWordLeft","removeWordRight","toggleOverwrite","convertIndentation","findNext","findPrevious","phrase","findAll","defineInputable","getCursor","getAllRanges","map","r","getDocument","getAllLines","splice","pop","getValue","language","module","exports"],"mappings":"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","file":"editor.js","sourcesContent":["\"use strict\";\n\nconst eventbus = require('./eventbus');\nconst command = require('./command');\nconst config = require('./config');\nconst fs = require('./fs');\nconst modes = require('./modes');\nconst sandboxes = require('./sandboxes');\n\nvar whitespace = global.ace.require(\"ace/ext/whitespace\");\nvar font = require(\"./lib/font\");\n\nvar IDENT_REGEX = /[a-zA-Z0-9_$\\-]+/;\nvar PATH_REGEX = /[\\/\\.a-zA-Z0-9_$\\-:]/;\n\neventbus.declare(\"editorloaded\");\neventbus.declare(\"selectionchanged\");\neventbus.declare(\"sessionclicked\"); // edit, session, event\n\nvar editors = [];\nvar activeEditor = null;\n\nvar api = {\n    hook: function() {\n        eventbus.on(\"configchanged\", function() {\n            setTimeout(api.updateConfiguration);\n        });\n\n        eventbus.on(\"switchsession\", function(edit, session) {\n            api.setEditorConfiguration(edit);\n            api.setSessionConfiguration(session);\n        });\n\n        fs.on(\"unlink\", function(path) {\n            editors.forEach(function(edit) {\n                if (edit.getSession().filename === path) {\n                    require(\"./session_manager\").go(\"zed::start\", edit);\n                }\n            });\n        });\n\n        $(\"body\").append('<div id=\"editor-wrapper-wrapper\"><div id=\"editor-wrapper\"></div></div>');\n    },\n    setEditorConfiguration: function(edit) {\n        var session = edit.getSession();\n        edit.setHighlightActiveLine(config.getPreference(\"highlightActiveLine\", session));\n        edit.setHighlightGutterLine(config.getPreference(\"highlightGutterLine\", session));\n        edit.setFontSize(config.getPreference(\"fontSize\", session));\n        edit.setShowPrintMargin(config.getPreference(\"showPrintMargin\", session));\n        edit.setPrintMarginColumn(config.getPreference(\"printMarginColumn\", session));\n        edit.setShowInvisibles(config.getPreference(\"showInvisibles\", session));\n        edit.setDisplayIndentGuides(config.getPreference(\"displayIndentGuides\", session));\n        edit.setOption(\"scrollPastEnd\", config.getPreference(\"scrollPastEnd\", session));\n        edit.setAnimatedScroll(config.getPreference(\"animatedScroll\", session));\n        edit.setShowFoldWidgets(config.getPreference(\"showFoldWidgets\", session));\n        edit.setScrollSpeed(config.getPreference(\"scrollSpeed\", session));\n        edit.renderer.setShowGutter(config.getPreference(\"showGutter\", session));\n        edit.setHighlightSelectedWord(config.getPreference(\"highlightSelectedWord\", session));\n        edit.setBehavioursEnabled(config.getPreference(\"behaviorsEnabled\", session)); // ( -> ()\n        edit.setWrapBehavioursEnabled(config.getPreference(\"wrapBehaviorsEnabled\", session)); // same as above but with selection\n        var fontFamily = config.getPreference(\"fontFamily\");\n        if (font.isInstalled(fontFamily)) {\n            $(edit.container).css(\"font-family\", config.getPreference(\"fontFamily\"));\n        } else {\n            eventbus.emit(\"sessionactivityfailed\", session, \"Invalid font: \" + fontFamily);\n        }\n\n        edit.removeAllListeners(\"paste\");\n        if (config.getPreference(\"autoIndentOnPaste\", session)) {\n            edit.on(\"paste\", function(e) {\n                autoIndentOnPaste(edit, session, e);\n            });\n        }\n        edit.setKeyboardHandler({\n            vim: \"ace/keyboard/vim\",\n            emacs: \"ace/keyboard/emacs\",\n            zed: null\n        }[config.getPreference(\"keybinding\", session)]);\n    },\n    setSessionConfiguration: function(session) {\n        session.setTabSize(config.getPreference(\"tabSize\", session));\n        session.setUseSoftTabs(config.getPreference(\"useSoftTabs\", session));\n        session.setUseWrapMode(config.getPreference(\"wordWrap\", session));\n        session.setWrapLimitRange(null, config.getPreference(\"wordWrapColumn\", session));\n    },\n    updateConfiguration: function() {\n        api.getEditors(true).forEach(function(edit) {\n            api.setEditorConfiguration(edit);\n        });\n        var session_manager = require(\"./session_manager\");\n        var sessions = _.values(session_manager.getSessions()).concat(_.values(session_manager.specialDocs));\n        _.each(sessions, function(session) {\n            api.setSessionConfiguration(session);\n        });\n    },\n    // Automatically called after all plugins are instantiated\n    init: function() {\n        $(\"#editor-wrapper\").append(\"<div id='editor0' class='editor-single'>\");\n        $(\"#editor-wrapper\").append(\"<div id='editor1' class='editor-disabled'>\");\n        $(\"#editor-wrapper\").append(\"<div id='editor2' class='editor-disabled'>\");\n\n        ace.config.set(\"basePath\", \"node_modules/ace-builds/src-noconflict\");\n        ace.config.setDefaultValue(\"editor\", \"enableBasicAutocompletion\", true);\n\n        editors.push(ace.edit(\"editor0\"));\n        editors.push(ace.edit(\"editor1\"));\n        editors.push(ace.edit(\"editor2\"));\n\n        editors.forEach(function(editor) {\n            editor.$blockScrolling = Infinity;\n            editor.setShowPrintMargin(false);\n            // Disable ACE's built-in theming\n            editor.setTheme({\n                cssClass: \"_\",\n                cssText: \" \"\n            });\n            editor.on(\"focus\", function() {\n                activeEditor = editor;\n                editor.renderer.$cursorLayer.setSmoothBlinking(true);\n                eventbus.emit(\"splitswitched\", editor);\n            });\n            editor.on(\"blur\", function() {\n                require(\"./session_manager\").saveSession(editor.getSession());\n            });\n            editor.on(\"changeSelection\", function() {\n                eventbus.emit(\"selectionchanged\", editor);\n            });\n            editor.on(\"click\", function(e) {\n                eventbus.emit(\"sessionclicked\", editor, editor.session, e);\n            });\n        });\n        api.setActiveEditor(editors[0]);\n        // return;\n        eventbus.emit(\"editorloaded\", api);\n    },\n    createSession: function(path, content) {\n        var session = ace.createEditSession(content);\n        session.filename = path;\n        var mode = modes.getModeForSession(session);\n        session.setUseWrapMode(config.getPreference(\"wordWrap\"));\n        session.setTabSize(config.getPreference(\"tabSize\"));\n        session.setUseSoftTabs(config.getPreference(\"useSoftTabs\"));\n        session.setUseWorker(false);\n        modes.setSessionMode(session, mode);\n        if (config.getPreference(\"detectIndentation\")) {\n            whitespace.detectIndentation(session);\n        }\n        return session;\n    },\n    switchSession: function(session, edit) {\n        edit = edit || api.getActiveEditor();\n        var prevSession = edit.session;\n        edit.setSession(session);\n        edit.setReadOnly( !! session.readOnly);\n        eventbus.emit(\"switchsession\", edit, session, prevSession);\n    },\n    isInsertingSnippet: function() {\n        return !!activeEditor.tabstopManager;\n    },\n    getActiveEditor: function() {\n        return activeEditor;\n    },\n    setActiveEditor: function(editor) {\n        activeEditor = editor;\n        // TODO: fix this\n        if(!fs.isEmpty) {\n            activeEditor.focus();\n        }\n    },\n    getEditors: function(all) {\n        if (all) {\n            return editors;\n        }\n\n        return editors.filter(function(edit) {\n            return $(edit.container).is(':visible');\n        });\n    },\n    resizeEditors: function() {\n        api.getEditors().forEach(function(edit) {\n            edit.resize();\n        });\n    },\n    getActiveSession: function() {\n        return api.getActiveEditor().getSession();\n    },\n    getSessionState: function(session) {\n        var undoStack = session.getUndoManager().$undoStack.slice(-25);\n        var redoStack = session.getUndoManager().$redoStack.slice(-25);\n        return {\n            scrollTop: session.getScrollTop(),\n            scrollLeft: session.getScrollLeft(),\n            selection: session.getSelection().getRange(),\n            lastUse: session.lastUse,\n            undo: undoStack,\n            redo: redoStack\n        };\n    },\n    setSessionState: function(session, state) {\n        session.getSelection().setSelectionRange(state.selection, false);\n        session.setScrollTop(state.scrollTop);\n        session.setScrollLeft(state.scrollLeft);\n        session.lastUse = state.lastUse;\n\n        var undoManager = session.getUndoManager();\n\n        undoManager.$doc = session;\n        undoManager.$undoStack = state.undo || [];\n        undoManager.$redoStack = state.redo || [];\n    },\n    getIdentifierUnderCursor: function(edit, regex) {\n        regex = regex || IDENT_REGEX;\n        edit = edit || api.getActiveEditor();\n        return edit.getSession().getTextRange(api.getIdentifierUnderCursorRange(edit, regex));\n    },\n    getIdentifierUnderCursorRange: function(edit, regex) {\n        regex = regex || IDENT_REGEX;\n        edit = edit || api.getActiveEditor();\n        var Range = global.ace.require(\"ace/range\").Range;\n        var session = edit.getSession();\n        var cursor = edit.getCursorPosition();\n        var line = session.getLine(cursor.row);\n\n        // If cursor is not on an identifier at all, return empty string\n        if (!regex.test(line[cursor.column])) {\n            return \"\";\n        }\n\n        for (var startCol = cursor.column; startCol >= 0; startCol--) {\n            if (!regex.test(line[startCol])) {\n                startCol++;\n                break;\n            }\n        }\n        for (var endCol = cursor.column; endCol < line.length; endCol++) {\n            if (!regex.test(line[endCol])) {\n                break;\n            }\n        }\n        return new Range(cursor.row, startCol, cursor.row, endCol);\n    },\n    getPathUnderCursor: function(edit) {\n        return api.getIdentifierUnderCursor(edit, PATH_REGEX);\n    }\n};\n\nfunction autoIndentOnPaste(editor, session, e) {\n    var pos = editor.getSelectionRange().start;\n    var line = editor.getSession().getLine(pos.row);\n    var tabSize = config.getPreference(\"tabSize\", session);\n    var col = pos.column;\n    for (var i = 0; i < pos.column; i++) {\n        if (line[i] === \"\\t\") {\n            col += (tabSize - 1);\n        }\n    }\n    var tabAsSpaces = \"\";\n    for (i = 0; i < tabSize; i++) {\n        tabAsSpaces += \" \";\n    }\n    var text = e.text.replace(/\\t/gm, tabAsSpaces);\n    var lines = text.split(\"\\n\");\n    var regexp = /\\S/;\n    var min = -1;\n    var index;\n    for (i = 1; i < lines.length; i++) {\n        index = lines[i].search(regexp);\n        if (index !== -1 && (index < min || min === -1)) {\n            min = index;\n        }\n    }\n    var adjust = col - min;\n    if (min > -1 && adjust !== 0) {\n        if (adjust < 0) {\n            for (i = 1; i < lines.length; i++) {\n                lines[i] = lines[i].substring(-adjust);\n            }\n        } else if (adjust > 0) {\n            var add = \"\";\n            for (i = 0; i < adjust; i++) {\n                add += \" \";\n            }\n\n            for (i = 1; i < lines.length; i++) {\n                lines[i] = add + lines[i];\n            }\n        }\n    }\n\n    lines[0] = lines[0].substring(lines[0].search(regexp));\n    e.text = lines.join(\"\\n\");\n    if (!config.getPreference(\"useSoftTabs\", session)) {\n        regexp = new RegExp(tabAsSpaces, \"gm\");\n        e.text = e.text.replace(regexp, \"\\t\");\n    }\n}\n\nfunction find(session, needle, dir) {\n    var Search = global.ace.require(\"ace/search\").Search;\n    var search = new Search();\n    search.$options.wrap = true;\n    search.$options.needle = needle;\n    search.$options.caseSensitive = true;\n    search.$options.wholeWord = true;\n    search.$options.backwards = dir == -1;\n    return search.find(session);\n}\n\nfunction selectMore(edit, dir) {\n    var session = edit.getSession();\n    var sel = session.multiSelect;\n\n    var range = sel.toOrientedRange();\n    var needle = session.getTextRange(range);\n\n    var newRange = find(session, needle, dir);\n    if (newRange) {\n        newRange.cursor = dir == -1 ? newRange.start : newRange.end;\n        edit.multiSelect.addRange(newRange);\n    }\n}\n\ncommand.define(\"Navigate:Line\", {\n    doc: \"Prompts for a specific line to jump to within the file.\",\n    exec: function(edit, session) {\n        return command.exec(\"Navigate:Goto\", edit, session, \":\");\n    },\n    readOnly: true\n});\n\ncommand.define(\"Navigate:Path Under Cursor\", {\n    doc: \"Open the file indicated by the cursor.\",\n    exec: function(edit, session) {\n        var path = api.getPathUnderCursor();\n        return command.exec(\"Navigate:Goto\", edit, session, path);\n    }\n});\n\n// FOLD\ncommand.define(\"Fold:Fold\", {\n    doc: \"Hide the code block currently enclosing the cursor.\",\n    exec: function(editor) {\n        editor.session.toggleFold(false);\n    },\n    readOnly: true\n});\n\ncommand.define(\"Fold:Unfold\", {\n    doc: \"Show a hidden code block.\",\n    exec: function(editor) {\n        editor.session.toggleFold(true);\n    },\n    readOnly: true\n});\n\ncommand.define(\"Fold:Fold All\", {\n    doc: \"Hide all possible code blocks for the current mode.\",\n    exec: function(editor) {\n        editor.session.foldAll();\n    },\n    readOnly: true\n});\n\ncommand.define(\"Fold:Unfold All\", {\n    doc: \"Show all hidden code blocks.\",\n    exec: function(editor) {\n        editor.session.unfold();\n    },\n    readOnly: true\n});\n\n\n// SELECT\ncommand.define(\"Select:Up\", {\n    doc: \"Move the cursor up one line, altering the selection.\",\n    exec: function(editor) {\n        editor.getSelection().selectUp();\n    },\n    multiSelectAction: \"forEach\",\n    readOnly: true\n});\n\ncommand.define(\"Select:All\", {\n    doc: \"Select entire document.\",\n    exec: function(editor) {\n        editor.selectAll();\n    },\n    readOnly: true,\n    scrollIntoView: false\n});\n\ncommand.define(\"Select:None\", {\n    doc: \"Clear the selection.\",\n    exec: function(editor) {\n        editor.clearSelection();\n    },\n    readOnly: true,\n    scrollIntoView: false\n});\n\ncommand.define(\"Select:To File End\", {\n    doc: \"Select from the cursor to the end of the file.\",\n    exec: function(editor) {\n        editor.getSelection().selectFileEnd();\n    },\n    multiSelectAction: \"forEach\",\n    readOnly: true\n});\n\ncommand.define(\"Select:Down\", {\n    doc: \"Move the cursor down one line, altering the selection.\",\n    exec: function(editor) {\n        editor.getSelection().selectDown();\n    },\n    multiSelectAction: \"forEach\",\n    readOnly: true\n});\n\ncommand.define(\"Select:Word Left\", {\n    doc: \"Move the cursor one word left, altering the selection.\",\n    exec: function(editor) {\n        editor.getSelection().selectWordLeft();\n    },\n    multiSelectAction: \"forEach\",\n    readOnly: true\n});\n\ncommand.define(\"Select:To Line Start\", {\n    doc: \"Select from the cursor to the beginning of the current line.\",\n    exec: function(editor) {\n        editor.getSelection().selectLineStart();\n    },\n    multiSelectAction: \"forEach\",\n    readOnly: true\n});\n\ncommand.define(\"Select:Left\", {\n    doc: \"Move the cursor one character left, altering the selection.\",\n    exec: function(editor) {\n        editor.getSelection().selectLeft();\n    },\n    multiSelectAction: \"forEach\",\n    readOnly: true\n});\n\ncommand.define(\"Select:Word Right\", {\n    doc: \"Move the cursor one word right, altering the selection.\",\n    exec: function(editor) {\n        editor.getSelection().selectWordRight();\n    },\n    multiSelectAction: \"forEach\",\n    readOnly: true\n});\n\ncommand.define(\"Select:To Line End\", {\n    doc: \"Select from the cursor to the end of the current line.\",\n    exec: function(editor) {\n        editor.getSelection().selectLineEnd();\n    },\n    multiSelectAction: \"forEach\",\n    readOnly: true\n});\n\ncommand.define(\"Select:Right\", {\n    doc: \"Move the cursor one character right, altering the selection.\",\n    exec: function(editor) {\n        editor.getSelection().selectRight();\n    },\n    multiSelectAction: \"forEach\",\n    readOnly: true\n});\n\ncommand.define(\"Select:Page Down\", {\n    doc: \"Move the cursor one page down, altering the selection.\",\n    exec: function(editor) {\n        editor.selectPageDown();\n    },\n    readOnly: true\n});\n\ncommand.define(\"Select:To Matching Brace\", {\n    doc: \"Select a code block denoted by matching braces.\",\n    exec: function(editor) {\n        editor.jumpToMatching(true);\n    },\n    multiSelectAction: \"forEach\",\n    readOnly: true\n});\n\ncommand.define(\"Select:Page Up\", {\n    doc: \"Move the cursor one page up, altering the selection.\",\n    exec: function(editor) {\n        editor.selectPageUp();\n    },\n    readOnly: true\n});\n\ncommand.define(\"Select:To File Start\", {\n    doc: \"Select from the mouse cursor to the beginning of the document.\",\n    exec: function(editor) {\n        editor.getSelection().selectFileStart();\n    },\n    readOnly: true\n});\n\ncommand.define(\"Select:Duplicate\", {\n    doc: \"Duplicate the currently selected text.\",\n    exec: function(editor) {\n        editor.duplicateSelection();\n    },\n    multiSelectAction: \"forEach\"\n});\n\n\n// CURSOR\ncommand.define(\"Cursor:Up\", {\n    doc: \"Move the cursor up one line.\",\n    exec: function(editor, session, args) {\n        editor.navigateUp(args && args.times);\n    },\n    multiSelectAction: \"forEach\",\n    readOnly: true\n});\n\ncommand.define(\"Cursor:Down\", {\n    doc: \"Move the cursor down one line.\",\n    exec: function(editor, session, args) {\n        editor.navigateDown(args && args.times);\n    },\n    multiSelectAction: \"forEach\",\n    readOnly: true\n});\n\ncommand.define(\"Cursor:File Start\", {\n    doc: \"Move the cursor to the beginning of the document.\",\n    exec: function(editor) {\n        editor.navigateFileStart();\n    },\n    multiSelectAction: \"forEach\",\n    readOnly: true,\n    scrollIntoView: \"animate\"\n});\n\ncommand.define(\"Cursor:File End\", {\n    doc: \"Move the cursor to the end of the document.\",\n    exec: function(editor) {\n        editor.navigateFileEnd();\n    },\n    multiSelectAction: \"forEach\",\n    readOnly: true,\n    scrollIntoView: \"animate\"\n});\n\ncommand.define(\"Cursor:Word Left\", {\n    doc: \"Move the cursor one word to the left.\",\n    exec: function(editor) {\n        editor.navigateWordLeft();\n    },\n    multiSelectAction: \"forEach\",\n    readOnly: true\n});\n\ncommand.define(\"Cursor:Word Right\", {\n    doc: \"Move the cursor one word to the right.\",\n    exec: function(editor) {\n        editor.navigateWordRight();\n    },\n    multiSelectAction: \"forEach\",\n    readOnly: true\n});\n\ncommand.define(\"Cursor:Line Start\", {\n    doc: \"Move the cursor to the beginning of the current line.\",\n    exec: function(editor) {\n        editor.navigateLineStart();\n    },\n    multiSelectAction: \"forEach\",\n    readOnly: true\n});\n\ncommand.define(\"Cursor:Left\", {\n    doc: \"Move the cursor one character to the left.\",\n    exec: function(editor, session, args) {\n        editor.navigateLeft(args && args.times);\n    },\n    multiSelectAction: \"forEach\",\n    readOnly: true\n});\n\ncommand.define(\"Cursor:Line End\", {\n    doc: \"Move the cursor to the end of the line.\",\n    exec: function(editor) {\n        editor.navigateLineEnd();\n    },\n    multiSelectAction: \"forEach\",\n    readOnly: true\n});\n\ncommand.define(\"Cursor:Right\", {\n    doc: \"Move the cursor one character to the right.\",\n    exec: function(editor, session, args) {\n        editor.navigateRight(args && args.times);\n    },\n    multiSelectAction: \"forEach\",\n    readOnly: true\n});\n\ncommand.define(\"Cursor:Page Down\", {\n    doc: \"Move the cursor one page down.\",\n    exec: function(editor) {\n        editor.gotoPageDown();\n    },\n    readOnly: true\n});\n\ncommand.define(\"Cursor:Page Up\", {\n    doc: \"Move the cursor one page up.\",\n    exec: function(editor) {\n        editor.gotoPageUp();\n    },\n    readOnly: true\n});\n\ncommand.define(\"Cursor:To Matching Brace\", {\n    doc: \"Move the cursor to the matching brace character, if present.\",\n    exec: function(editor) {\n        editor.jumpToMatching();\n    },\n    multiSelectAction: \"forEach\",\n    readOnly: true\n});\n\ncommand.define(\"Cursor:Center\", {\n    doc: \"Scroll the document such that the cursor is in the vertical center of the screen.\",\n    exec: function(editor) {\n        editor.centerSelection();\n    },\n    readOnly: true\n});\n\n// Cursor: Multiple\ncommand.define(\"Cursor:Multiple:Add At Next Instance Of Identifier\", {\n    doc: \"Add an additional cursor where the current word next appears in the current file.\",\n    exec: function(edit) {\n        if (edit.selection.isEmpty()) {\n            var range = api.getIdentifierUnderCursorRange();\n            edit.selection.setSelectionRange(range);\n        }\n        selectMore(edit, 1);\n    }\n});\n\ncommand.define(\"Cursor:Multiple:Add At Previous Instance Of Identifier\", {\n    doc: \"Add an additional cursor where the current word previously appears in the current file.\",\n    exec: function(edit) {\n        if (edit.selection.isEmpty()) {\n            var range = api.getIdentifierUnderCursorRange();\n            edit.selection.setSelectionRange(range);\n        }\n        selectMore(edit, -1);\n    }\n});\n\ncommand.define(\"Cursor:Multiple:Add Above\", {\n    doc: \"Add an additional cursor one row above the current cursor.\",\n    exec: function(editor) {\n        editor.selectMoreLines(-1);\n    },\n});\n\ncommand.define(\"Cursor:Multiple:Add Below\", {\n    doc: \"Add an additional cursor one row below the current cursor.\",\n    exec: function(editor) {\n        editor.selectMoreLines(1);\n    },\n});\n\ncommand.define(\"Cursor:Multiple:Add Above Skip Current\", {\n    doc: \"Move the most recently created multiple curson up by one row.\",\n    exec: function(editor) {\n        editor.selectMoreLines(-1, true);\n    },\n});\n\ncommand.define(\"Cursor:Multiple:Add Below Skip Current\", {\n    doc: \"Move the most recently created multiple curson down by one row.\",\n    exec: function(editor) {\n        editor.selectMoreLines(1, true);\n    },\n});\n\ncommand.define(\"Cursor:Multiple:Align cursors\", {\n    doc: \"Align all cursors and text to the same vertical position\",\n    exec: function(editor) {\n        editor.alignCursors();\n    },\n});\n\n// SCROLL\n\ncommand.define(\"Scroll:Page Down\", {\n    doc: \"Scroll the document one page down without moving the cursor position.\",\n    exec: function(editor) {\n        editor.scrollPageDown();\n    },\n    readOnly: true\n});\ncommand.define(\"Scroll:Page Up\", {\n    doc: \"Scroll the document one page up witout moving the cursor position.\",\n    exec: function(editor) {\n        editor.scrollPageUp();\n    },\n    readOnly: true\n});\n\ncommand.define(\"Scroll:Down\", {\n    doc: \"Scroll the document down without moving the cursor position.\",\n    exec: function(e) {\n        e.renderer.scrollBy(0, 2 * e.renderer.layerConfig.lineHeight);\n    },\n    readOnly: true\n});\n\ncommand.define(\"Scroll:Up\", {\n    doc: \"Scroll the document up without moving the cursor position.\",\n    exec: function(e) {\n        e.renderer.scrollBy(0, -2 * e.renderer.layerConfig.lineHeight);\n    },\n    readOnly: true\n});\n\n// MACRO\ncommand.define(\"Macro:Toggle Recording\", {\n    doc: \"Begin recording a macro, or halt recording if it has already begun.\",\n    exec: function(editor) {\n        editor.commands.toggleRecording(editor);\n    },\n    readOnly: true\n});\n\ncommand.define(\"Macro:Replay\", {\n    doc: \"Repeat the last-recorded macro.\",\n    exec: function(editor) {\n        editor.commands.replay(editor);\n    },\n    readOnly: true\n});\n\n// EDIT\ncommand.define(\"Edit:Remove Line\", {\n    doc: \"Delete the current line.\",\n    exec: function(editor) {\n        editor.removeLines();\n    },\n    multiSelectAction: \"forEach\"\n});\n\ncommand.define(\"Edit:Toggle Comment\", {\n    doc: \"Comment the current line.\",\n    exec: function(editor) {\n        editor.toggleCommentLines();\n    },\n    multiSelectAction: \"forEach\",\n    scrollIntoView: \"selectionPart\"\n});\n\ncommand.define(\"Edit:Number:Increase\", {\n    doc: \"Add 1 to the number under the cursor.\",\n    exec: function(editor) {\n        editor.modifyNumber(1);\n    },\n    multiSelectAction: \"forEach\"\n});\n\ncommand.define(\"Edit:Number:Decrease\", {\n    doc: \"Subtract 1 from the number under the cursor.\",\n    exec: function(editor) {\n        editor.modifyNumber(-1);\n    },\n    multiSelectAction: \"forEach\"\n});\n\ncommand.define(\"Edit:Undo\", {\n    doc: \"Revert the previous change.\",\n    exec: function(editor) {\n        editor.undo();\n    }\n});\n\ncommand.define(\"Edit:Redo\", {\n    doc: \"Redo the previous undo.\",\n    exec: function(editor) {\n        editor.redo();\n    }\n});\n\ncommand.define(\"Edit:Copy Lines Up\", {\n    doc: \"Copy the currently selected lines above the current selection. \" + \"The current line is used if there is no selection.\",\n    exec: function(editor) {\n        editor.copyLinesUp();\n    },\n    multiSelectAction: \"forEach\"\n});\ncommand.define(\"Edit:Move Lines Up\", {\n    doc: \"Move the currently selected lines up one line. \" + \"The current line is used if there is no selection.\",\n    exec: function(editor) {\n        editor.moveLinesUp();\n    },\n    multiSelectAction: \"forEach\"\n});\ncommand.define(\"Edit:Copy Lines Down\", {\n    doc: \"Copy the currently selected lines below the current selection. \" + \"The current line is used if there is no selection.\",\n    exec: function(editor) {\n        editor.copyLinesDown();\n    },\n    multiSelectAction: \"forEach\"\n});\ncommand.define(\"Edit:Move Lines Down\", {\n    doc: \"Move the currently selected lines down one line. \" + \"The current line is used if there is no selection.\",\n    exec: function(editor) {\n        editor.moveLinesDown();\n    },\n    multiSelectAction: \"forEach\"\n});\ncommand.define(\"Edit:Delete\", {\n    doc: \"Deletes one character to the right.\",\n    exec: function(editor) {\n        editor.remove(\"right\");\n    },\n    multiSelectAction: \"forEach\"\n});\ncommand.define(\"Edit:Backspace\", {\n    doc: \"Deletes one character to the left.\",\n    exec: function(editor) {\n        editor.remove(\"left\");\n    },\n    multiSelectAction: \"forEach\"\n});\n\ncommand.define(\"Edit:Remove To Line Start\", {\n    doc: \"Deletes everything from the cursor to the start of the line.\",\n    exec: function(editor) {\n        editor.removeToLineStart();\n    },\n    multiSelectAction: \"forEach\"\n});\n\ncommand.define(\"Edit:Remove To Line End\", {\n    doc: \"Deletes everything from the cursor to the end of the line.\",\n    exec: function(editor) {\n        editor.removeToLineEnd();\n    },\n    multiSelectAction: \"forEach\"\n});\n\ncommand.define(\"Edit:Outdent\", {\n    doc: \"Decrease the indentation of the current line.\",\n    exec: function(editor) {\n        editor.blockOutdent();\n    },\n    multiSelectAction: \"forEach\"\n});\n\ncommand.define(\"Edit:Indent\", {\n    doc: \"Insert a tab at the cursor position.\",\n    exec: function(editor) {\n        editor.indent();\n    },\n    multiSelectAction: \"forEach\",\n});\n\ncommand.define(\"Edit:Block Outdent\", {\n    doc: \"Decrease the indent of the selected block.\",\n    exec: function(editor) {\n        editor.blockOutdent();\n    },\n    multiSelectAction: \"forEach\",\n    scrollIntoView: \"selectionPart\"\n});\n\ncommand.define(\"Edit:Block Indent\", {\n    doc: \"Increase the indent of the selected block.\",\n    exec: function(editor) {\n        editor.blockIndent();\n    },\n    multiSelectAction: \"forEach\",\n    scrollIntoView: \"selectionPart\"\n});\n\ncommand.define(\"Edit:Split Line\", {\n    doc: \"Splits the current line into two lines.\",\n    exec: function(editor) {\n        editor.splitLine();\n    },\n    multiSelectAction: \"forEach\"\n});\n\ncommand.define(\"Edit:Transpose Letters\", {\n    doc: \"Swaps the character before the cursor with the character after \" + \"the cursor. Multiple invocations will have the effect of moving the \" + \"character before the cursor forward through the file.\",\n    exec: function(editor) {\n        editor.transposeLetters();\n    },\n    multiSelectAction: function(editor) {\n        editor.transposeSelections(1);\n    }\n});\n\ncommand.define(\"Edit:Uppercase\", {\n    doc: \"Change the selected text into uppercase.\",\n    exec: function(editor) {\n        editor.toUpperCase();\n    },\n    multiSelectAction: \"forEach\"\n});\n\ncommand.define(\"Edit:Lowercase\", {\n    doc: \"Change the selected text into lowercase.\",\n    exec: function(editor) {\n        editor.toLowerCase();\n    },\n    multiSelectAction: \"forEach\"\n});\n\ncommand.define(\"Edit:Remove Word Left\", {\n    doc: \"Delete one word to the left.\",\n    exec: function(editor) {\n        editor.removeWordLeft();\n    },\n    multiSelectAction: \"forEach\"\n});\n\ncommand.define(\"Edit:Remove Word Right\", {\n    doc: \"Delete one word to the right.\",\n    exec: function(editor) {\n        editor.removeWordRight();\n    },\n    multiSelectAction: \"forEach\"\n});\n\ncommand.define(\"Edit:Overwrite Mode\", {\n    doc: \"Toggle overwrite mode, which causes each character typed to \" + \"replace the one at right of the cursor instead of being inserted before it.\",\n    exec: function(editor) {\n        editor.toggleOverwrite();\n    }\n});\n\ncommand.define(\"Edit:Detect Indentation\", {\n    doc: \"\",\n    exec: function(edit) {\n        whitespace.detectIndentation(edit.session);\n    }\n});\n\ncommand.define(\"Edit:Convert Indentation\", {\n    doc: \"\",\n    exec: function(edit) {\n        // todo this command needs a way to get values for tabChar and tabLength\n        whitespace.convertIndentation(edit.session);\n    }\n});\n\n// FIND\ncommand.define(\"Find:Find\", {\n    doc: \"Prompt for a case-sensitive search within the current file.\",\n    exec: function(edit, session) {\n        command.exec(\"Navigate:Goto\", edit, session, \":/\");\n    },\n    readOnly: true\n});\n\ncommand.define(\"Find:Find Case Insensitive\", {\n    doc: \"Prompt for a case-insensitive search within the current file.\",\n    exec: function(edit, session) {\n        command.exec(\"Navigate:Goto\", edit, session, \":|\");\n    },\n    readOnly: true\n});\n\ncommand.define(\"Find:Next\", {\n    doc: \"Jump to the next instance of the search term.\",\n    exec: function(editor) {\n        editor.findNext({\n            wholeWord: false\n        });\n    },\n    readOnly: true\n});\n\ncommand.define(\"Find:Previous\", {\n    doc: \"Jump to the previous instance of the search term.\",\n    exec: function(editor) {\n        editor.findPrevious({\n            wholeWord: false\n        });\n    },\n    readOnly: true\n});\n\ncommand.define(\"Find:All\", {\n    doc: \"Select all instances of the search term (or current word) and \" + \"place a cursor at each one.\",\n    exec: function(edit) {\n        var phrase;\n        if (edit.selection.isEmpty()) {\n            phrase = api.getIdentifierUnderCursor();\n        } else {\n            phrase = edit.getSession().getTextRange(edit.getSelectionRange());\n        }\n        edit.findAll(phrase, {\n            wholeWord: false\n        });\n    },\n    readOnly: true\n});\n\ncommand.define(\"Find:Next Instance Of Identifier\", {\n    doc: \"Jump to the next occurence of the word currently under the cursor.\",\n    exec: function(edit) {\n        if (edit.selection.isEmpty()) {\n            var range = api.getIdentifierUnderCursorRange();\n            edit.selection.setSelectionRange(range);\n        }\n        edit.findNext({\n            caseSensitive: true,\n            wholeWord: true\n        });\n    },\n    readOnly: true\n});\n\ncommand.define(\"Find:Previous Instance Of Identifier\", {\n    doc: \"Jump to the previous occurence of the word currently under the cursor.\",\n    exec: function(edit) {\n        if (edit.selection.isEmpty()) {\n            var range = api.getIdentifierUnderCursorRange();\n            edit.selection.setSelectionRange(range);\n        }\n        edit.findPrevious({\n            caseSensitive: true,\n            wholeWord: true\n        });\n    },\n    readOnly: true\n});\n\nsandboxes.defineInputable(\"cursor\", function(session) {\n    return session.selection.getCursor();\n});\n\nsandboxes.defineInputable(\"cursors\", function(session) {\n    return session.selection.getAllRanges().map(function(r) {\n        return r.cursor || r.end;\n    });\n});\n\nsandboxes.defineInputable(\"cursorIndex\", function(session) {\n    var cursor = session.selection.getCursor();\n    var lines = session.getDocument().getAllLines();\n    var index = cursor.column;\n    lines.splice(cursor.row);\n    while (lines.length > 0) {\n        index += lines.pop().length + 1;\n    }\n    return index;\n});\n\nsandboxes.defineInputable(\"isInsertingSnippet\", function() {\n    return api.isInsertingSnippet();\n});\n\nsandboxes.defineInputable(\"lines\", function(session) {\n    return session.getDocument().getAllLines();\n});\n\nsandboxes.defineInputable(\"scrollPosition\", function(session) {\n    return {\n        scrollTop: session.getScrollTop(),\n        scrollLeft: session.getScrollLeft()\n    };\n});\n\nsandboxes.defineInputable(\"selectionRange\", function(session) {\n    return session.selection.getRange();\n});\n\nsandboxes.defineInputable(\"selectionText\", function(session) {\n    return session.getTextRange(session.selection.getRange());\n});\n\nsandboxes.defineInputable(\"text\", function(session) {\n    return session.getValue();\n});\n\nsandboxes.defineInputable(\"modeName\", function(session) {\n    return session.mode.language;\n});\n\nsandboxes.defineInputable(\"mode\", function(session) {\n    return session.mode;\n});\n\nmodule.exports = api;\n"]}