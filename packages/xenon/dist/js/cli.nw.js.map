{"version":3,"sources":["../../src/js/cli.nw.js"],"names":["define","require","exports","module","plugin","consumes","options","imports","register","openUi","open_ui","history","gui","nodeRequire","get","args","App","argv","console","log","openPath","on","cmdline","split","process","platform","splice","forEach","path","ignore","close","url","indexOf","lookupProjectByUrl","then","project","open","name"],"mappings":"AAAA;;AAEA;;AACAA,OAAO,UAASC,OAAT,EAAkBC,OAAlB,EAA2BC,MAA3B,EAAmC;AACtCC,WAAOC,QAAP,GAAkB,CAAC,SAAD,EAAY,SAAZ,CAAlB;AACA,WAAOD,MAAP;;AAEA,aAASA,MAAT,CAAgBE,OAAhB,EAAyBC,OAAzB,EAAkCC,QAAlC,EAA4C;AACxC,YAAIC,SAASF,QAAQG,OAArB;AACA,YAAIC,UAAUJ,QAAQI,OAAtB;;AAEA,YAAIC,MAAMC,YAAY,QAAZ,CAAV;AACA,YAAIP,UAAUL,QAAQ,eAAR,CAAd;;AAEA;;AAEA,YAAG,CAACK,QAAQQ,GAAR,CAAY,KAAZ,CAAJ,EAAwB;AACpB,mBAAON,UAAP;AACH;;AAED,YAAIO,OAAOH,IAAII,GAAJ,CAAQC,IAAnB;AACAC,gBAAQC,GAAR,CAAY,MAAZ,EAAoBJ,IAApB;AACA,YAAIA,KAAK,CAAL,CAAJ,EAAa;AACTK,qBAASL,KAAK,CAAL,CAAT;AACH;AACDH,YAAII,GAAJ,CAAQK,EAAR,CAAW,MAAX,EAAmB,UAASC,OAAT,EAAkB;AACjCJ,oBAAQC,GAAR,CAAY,gBAAZ,EAA8BG,OAA9B;AACA,gBAAIP,OAAOO,QAAQC,KAAR,CAAc,KAAd,CAAX;AACA,gBAAIC,QAAQC,QAAR,KAAqB,QAAzB,EAAmC;AAC/BV,uBAAOA,KAAKW,MAAL,CAAY,CAAZ,CAAP;AACH;AACDX,iBAAKY,OAAL,CAAa,UAASC,IAAT,EAAe;AACxBR,yBAASQ,IAAT;AACH,aAFD;AAGH,SATD;;AAWApB;;AAEA,iBAASY,QAAT,CAAkBQ,IAAlB,EAAwB;AACpB,gBAAGnB,OAAOoB,MAAV,EAAkB;AACd;AACH;AACDX,oBAAQC,GAAR,CAAY,SAAZ,EAAuBS,IAAvB;AACAnB,mBAAOqB,KAAP;AACA,gBAAIC,MAAM,UAAUH,IAApB;AACA,gBAAGA,KAAKI,OAAL,CAAa,SAAb,MAA4B,CAA5B,IAAiCJ,KAAKI,OAAL,CAAa,UAAb,MAA6B,CAAjE,EAAoE;AAChED,sBAAMH,IAAN;AACH;AACDjB,oBAAQsB,kBAAR,CAA2BF,GAA3B,EAAgCG,IAAhC,CAAqC,UAASC,OAAT,EAAkB;AACnD;AACI,oBAAIA,OAAJ,EAAa;AACT1B,2BAAO2B,IAAP,CAAYD,QAAQE,IAApB,EAA0BN,GAA1B;AACH,iBAFD,MAEO;AACHtB,2BAAO2B,IAAP,CAAYR,IAAZ,EAAkBG,GAAlB;AACH;;AAEL;AACH,aATD;AAUH;AACJ;AACJ,CAzDD","file":"cli.nw.js","sourcesContent":["'use strict';\n\n// TODO: fix cli\ndefine(function(require, exports, module) {\n    plugin.consumes = [\"open_ui\", \"history\"];\n    return plugin;\n\n    function plugin(options, imports, register) {\n        var openUi = imports.open_ui;\n        var history = imports.history;\n\n        var gui = nodeRequire(\"nw.gui\");\n        var options = require(\"./lib/options\");\n\n        // gui.Window.get().showDevTools();\n\n        if(!options.get(\"cli\")) {\n            return register();\n        }\n\n        var args = gui.App.argv;\n        console.log(\"ARGS\", args);\n        if (args[0]) {\n            openPath(args[0]);\n        }\n        gui.App.on(\"open\", function(cmdline) {\n            console.log(\"Got open event\", cmdline);\n            var args = cmdline.split(/\\s+/);\n            if (process.platform !== \"darwin\") {\n                args = args.splice(1);\n            }\n            args.forEach(function(path) {\n                openPath(path);\n            });\n        });\n\n        register();\n\n        function openPath(path) {\n            if(openUi.ignore) {\n                return;\n            }\n            console.log(\"Opening\", path);\n            openUi.close();\n            var url = \"node:\" + path;\n            if(path.indexOf(\"http://\") === 0 || path.indexOf(\"https://\") === 0) {\n                url = path;\n            }\n            history.lookupProjectByUrl(url).then(function(project) {\n                // setTimeout(function() {\n                    if (project) {\n                        openUi.open(project.name, url);\n                    } else {\n                        openUi.open(path, url);\n                    }\n\n                // }, 1000);\n            });\n        }\n    }\n});\n"]}