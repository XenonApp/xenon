{"version":3,"sources":["../../src/js/menu.js"],"names":["remote","require","Menu","command","config","editor","eventbus","template","utils","win","api","disabled","hook","on","edit","newSession","getPreference","updateMenu","getActiveSession","e","console","error","hideMenu","session","currentTemplate","slice","dashRegExp","updateTemplate","node","index","parent","Array","isArray","forEach","label","cmd","lookup","isVisible","splice","key","identifyCurrentKey","split","replace","accelerator","getActiveEditor","click","exec","name","getSession","submenu","setMenu","buildFromTemplate","isMacOS","menu","setApplicationMenu","module","exports"],"mappings":"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","file":"menu.js","sourcesContent":["'use strict';\n\nconst remote = require('electron').remote;\nconst Menu = remote.Menu;\n\nconst command = require('./command');\nconst config = require('./config');\nconst editor = require('./editor');\nconst eventbus = require('./eventbus');\nconst template = require('./menu/template');\nconst utils = require('../shared/utils');\nconst win = require('./window');\n\nvar api = {\n    disabled: false,\n    hook: function() {\n        eventbus.on(\"switchsession\", function(edit, newSession) {\n            if (config.getPreference(\"showMenus\")) {\n                api.updateMenu(newSession);\n            }\n        });\n        eventbus.on(\"configchanged\", function() {\n            if (config.getPreference(\"showMenus\")) {\n                try {\n                    api.updateMenu(editor.getActiveSession());\n                } catch (e) {\n                    console.error(\"Error\", e);\n                }\n            } else {\n                api.hideMenu();\n            }\n        });\n    },\n    updateMenu: function(session) {\n        const currentTemplate = template.slice();\n        const dashRegExp = /-/g;\n        function updateTemplate(node, index, parent) {\n            if (Array.isArray(node)) {\n                node.forEach(updateTemplate);\n            } else if (node.label) {\n                if (node.command) {\n                    const cmd = command.lookup(node.command);\n                    if (!cmd || !command.isVisible(session, cmd)) {\n                        return parent.splice(index, 1);\n                    }\n                    let key = command.identifyCurrentKey(node.command);\n                    if (key) {\n                        key = key.split('|');\n                        key = key[0].replace(dashRegExp, '+');\n                        node.accelerator = key;\n                    }\n                    const edit = editor.getActiveEditor();\n                    node.click = () => command.exec(cmd.name, edit, edit.getSession());\n                }\n                if (node.submenu) {\n                    updateTemplate(node.submenu);\n                }\n            }\n        }\n        updateTemplate(currentTemplate);\n        setMenu(Menu.buildFromTemplate(currentTemplate));\n    },\n    hideMenu: function() {\n        if (!utils.isMacOS()) {\n            win.setMenu(null);\n        }\n    }\n};\n\nfunction setMenu(menu) {\n    if (utils.isMacOS()) {\n        Menu.setApplicationMenu(menu);\n    } else {\n        win.setMenu(menu);\n    }\n}\n\nmodule.exports = api;\n"]}