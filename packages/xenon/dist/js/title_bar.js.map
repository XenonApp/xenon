{"version":3,"sources":["../../src/js/title_bar.js"],"names":["eventbus","require","editor","command","window","useragent","global","ace","opts","declare","winButtons","barEl","pathBarEl","api","hook","useNativeFrame","isMac","$","append","buttonsEl","find","mousemove","css","mouseout","blur","focus","click","close","minimize","maximize","fullScreen","on","update","getEditors","forEach","edit","editorClasses","_","filter","container","getAttribute","split","cls","indexOf","clsToAdd","substring","length","each","attr","removeClass","addClass","switchSession","once","el","setActiveEditor","emit","setTimeout","exec","session","description","getSession","infoEl","html","show","hide","error","fadeIn","activeEdit","title","get","titleEl","text","filename","readOnly","module","exports"],"mappings":"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","file":"title_bar.js","sourcesContent":["'use strict';\n\nconst eventbus = require('./eventbus');\nconst editor = require('./editor');\nconst command = require('./command');\nconst window = require('./window');\n\nvar useragent = global.ace.require(\"ace/lib/useragent\");\nvar opts = require(\"./lib/options\");\n\neventbus.declare(\"projecttitlechanged\");\neventbus.declare(\"sessionactivitystarted\"); // session, name\neventbus.declare(\"sessionactivitycompleted\"); // session, name\neventbus.declare(\"sessionactivityfailed\"); // session, error\n\nvar winButtons;\nvar barEl, pathBarEl;\n\nvar api = {\n    hook: function() {\n        if (!window.useNativeFrame()) {\n            if (useragent.isMac) {\n                winButtons = \"<div class='close'></div><div class='minimize'></div><div class='maximize'></div>\";\n            } else {\n                winButtons = \"<div class='minimize'></div><div class='maximize'></div><div class='close'></div>\";\n            }\n            barEl = $(\"<div id='titlebar'><div class='windowbuttons'>\" + winButtons + \"</div><div class='title'></div><div class='fullscreen'></div>\");\n            $(\"body\").append(barEl);\n\n            // TODO: Rework this to toggle CSS styles\n            var buttonsEl = barEl.find(\".windowbuttons\");\n            if (useragent.isMac) {\n                buttonsEl.mousemove(function() {\n                    buttonsEl.find(\"div\").css(\"background-position-y\", '-16px');\n                });\n                buttonsEl.mouseout(function() {\n                    buttonsEl.find(\"div\").css(\"background-position-y\", '0');\n                });\n                $(window).blur(function() {\n                    buttonsEl.find(\"div\").css(\"background-position-y\", '-31px');\n                });\n                $(window).focus(function() {\n                    buttonsEl.find(\"div\").css(\"background-position-y\", '0');\n                });\n            }\n            buttonsEl.find(\".close\").click(function() {\n                window.close();\n            });\n            buttonsEl.find(\".minimize\").click(function() {\n                window.minimize();\n            });\n            buttonsEl.find(\".maximize\").click(function() {\n                window.maximize();\n            });\n            barEl.find(\".fullscreen\").click(function() {\n                window.fullScreen();\n            });\n        }\n\n        pathBarEl = $(\"<div id='pathbar-wrapper'>\");\n        $(\"#editor-wrapper\").append(pathBarEl);\n        eventbus.on(\"configchanged\", update);\n        eventbus.on(\"projecttitlechanged\", update);\n\n        // Editbar stuff\n        eventbus.on(\"splitchange\", function() {\n            editor.getEditors(true).forEach(function(edit) {\n                if (!edit.pathBarEl) {\n                    // Bit too early\n                    return;\n                }\n                var editorClasses = _.filter(edit.container.getAttribute(\"class\").split(\" \"), function(cls) {\n                    return cls.indexOf(\"editor-\") === 0;\n                });\n                var clsToAdd = \"pathbar-\" + editorClasses[0].substring(\"editor-\".length);\n                // Remove old pathbar-* classes\n                var pathBarEl = edit.pathBarEl;\n                _.each(pathBarEl.attr(\"class\").split(\" \"), function(cls) {\n                    if (cls.indexOf(\"pathbar-\") === 0) {\n                        pathBarEl.removeClass(cls);\n                    }\n                });\n                pathBarEl.addClass(clsToAdd);\n            });\n        });\n        eventbus.on(\"switchsession\", switchSession);\n\n        eventbus.once(\"editorloaded\", function() {\n            update();\n            editor.getEditors(true).forEach(function(edit) {\n                var el = $(\"<div class='pathbar'><div class='path'>No file</div><div class='info' 'display: none;'></div>\");\n                pathBarEl.append(el);\n                el.find(\".path\").click(function() {\n                    editor.setActiveEditor(edit);\n                    eventbus.emit(\"splitswitched\", edit);\n                    setTimeout(function() {\n                        command.exec(\"Navigate:Goto\", edit, edit.session);\n                    });\n                });\n                edit.pathBarEl = el;\n            });\n        });\n\n        eventbus.on(\"sessionactivitystarted\", function(session, description) {\n            editor.getEditors().forEach(function(edit) {\n                if (edit.getSession() === session) {\n                    var infoEl = edit.pathBarEl.find(\".info\");\n                    infoEl.html(description);\n                    infoEl.show();\n                }\n            });\n        });\n        eventbus.on(\"sessionactivitycompleted\", function(session) {\n            editor.getEditors().forEach(function(edit) {\n                if (edit.getSession() === session) {\n                    var infoEl = edit.pathBarEl.find(\".info\");\n                    infoEl.hide();\n                }\n            });\n        });\n        eventbus.on(\"sessionactivityfailed\", function(session, error) {\n            editor.getEditors().forEach(function(edit) {\n                if (edit.getSession() === session) {\n                    var infoEl = edit.pathBarEl.find(\".info\");\n                    infoEl.fadeIn();\n                    infoEl.html('<span class=\"error\">' + error + '</span>');\n                    setTimeout(function() {\n                        infoEl.hide();\n                    }, 3000);\n                }\n            });\n        });\n        eventbus.on(\"splitswitched\", function(activeEdit) {\n            editor.getEditors(true).forEach(function(edit) {\n                if (!edit.pathBarEl) {\n                    // Bit too early\n                    return;\n                }\n                if (edit !== activeEdit) {\n                    edit.pathBarEl.removeClass(\"active\");\n                } else {\n                    edit.pathBarEl.addClass(\"active\");\n                }\n            });\n        });\n    }\n};\n\nfunction update() {\n    var title = opts.get('title');\n    if (barEl) {\n        var titleEl = barEl.find(\".title\");\n\n        titleEl.html(\"<img src='img/zed-small.png'/>\" + title + \" \");\n    } else {\n        $(\"title\").text(title);\n    }\n}\n\nfunction switchSession(edit, session) {\n    var filename = session.filename || \"No file\";\n    edit.pathBarEl.find('.path').text(filename + (session.readOnly ? \" [Read Only]\" : \"\"));\n    edit.pathBarEl.find('.info').html(\"\");\n}\n\nmodule.exports = api;\n"]}