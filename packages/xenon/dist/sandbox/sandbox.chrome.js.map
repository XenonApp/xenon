{"version":3,"sources":["../../src/sandbox/sandbox.chrome.js"],"names":["require","source","origin","id","waitingForReply","global","sandboxRequest","module","call","args","Promise","resolve","reject","postMessage","command","window","addEventListener","message","data","exec","apiResponse","event","p","replyTo","undefined","err","result","url","fn","WEBPACK","slice","configDir","then","catch","console","error","toString"],"mappings":"AAAA;;AAEAA,QAAQ,mBAAR;;AAEA,IAAIC,MAAJ;AACA,IAAIC,MAAJ;AACA,IAAIC,KAAK,CAAT;AACA,IAAIC,kBAAkB,EAAtB;;AAEAC,OAAOC,cAAP,GAAwB,UAASC,MAAT,EAAiBC,IAAjB,EAAuBC,IAAvB,EAA6B;AACjD,WAAO,IAAIC,OAAJ,CAAY,UAASC,OAAT,EAAkBC,MAAlB,EAA0B;AACzCT;AACAC,wBAAgBD,EAAhB,IAAsB;AAClBQ,qBAASA,OADS;AAElBC,oBAAQA;AAFU,SAAtB;AAIAX,eAAOY,WAAP,CAAmB;AACfC,qBAAS,aADM;AAEfX,gBAAIA,EAFW;AAGfI,oBAAQA,MAHO;AAIfC,kBAAMA,IAJS;AAKfC,kBAAMA;AALS,SAAnB,EAMGP,MANH;AAOH,KAbM,CAAP;AAcH,CAfD;;AAiBAa,OAAOC,gBAAP,CAAwB,SAAxB,EAAmCC,WAAW;AAC1ChB,aAASgB,QAAQhB,MAAjB;AACAC,aAASe,QAAQf,MAAjB;AACA,QAAIe,QAAQC,IAAR,CAAaJ,OAAb,KAAyB,MAA7B,EAAqC;AACjCK,aAAKF,OAAL;AACH,KAFD,MAEO,IAAIA,QAAQC,IAAR,CAAaJ,OAAb,KAAyB,cAA7B,EAA6C;AAChDM,oBAAYH,OAAZ;AACH;AACJ,CARD;;AAUA,SAASG,WAAT,CAAqBC,KAArB,EAA4B;AACxB,UAAMH,OAAOG,MAAMH,IAAnB;AACA,QAAII,IAAIlB,gBAAgBc,KAAKK,OAArB,CAAR;;AAEA,QAAIC,cAAcN,KAAKO,GAAnB,IAA0B,SAASP,KAAKO,GAA5C,EAAiD;AAC7CH,UAAEV,MAAF,CAASM,KAAKO,GAAd;AACH,KAFD,MAEO;AACHH,UAAEX,OAAF,CAAUO,KAAKQ,MAAf;AACH;AACD,WAAOtB,gBAAgBc,KAAKK,OAArB,CAAP;AACH;;AAED,eAAeJ,IAAf,CAAoBE,KAApB,EAA2B;AACvB,UAAMH,OAAOG,MAAMH,IAAnB;AACA,UAAMf,KAAKe,KAAKf,EAAhB;AACA,UAAMwB,MAAMT,KAAKS,GAAjB;;AAEA,QAAI,CAACA,GAAL,EAAU;AACN;AACH;;AAED,QAAIC,EAAJ;;AAEA,QAAIC,OAAJ,EAAa;AACTD,aAAK5B,QAAS,YAAW2B,IAAIG,KAAJ,CAAU,CAAV,EAAa,CAAC,CAAd,CAAiB,KAArC,CAAL;AACH,KAFD,MAEO;AACH,YAAI;AACAF,iBAAK5B,QAAQkB,KAAKa,SAAL,GAAiBJ,GAAzB,CAAL;AACH,SAFD,CAEE,OAAOF,GAAP,EAAY;AACVG,iBAAK5B,QAAQ,cAAc2B,GAAtB,CAAL;AACH;AACJ;;AAED,QAAIT,KAAKU,EAAT,EAAa;AACTA,aAAKA,GAAGV,KAAKU,EAAR,CAAL;AACH;;AAEDlB,YAAQC,OAAR,CAAgBO,KAAKA,IAArB,EAA2Bc,IAA3B,CAAgCJ,EAAhC,EAAoCI,IAApC,CAAyCN,UAAU;AAC/C,YAAIT,UAAU;AACVH,qBAAS,SADC;AAEVS,qBAASpB,EAFC;AAGVuB,oBAAQA;AAHE,SAAd;AAKAL,cAAMpB,MAAN,CAAaY,WAAb,CAAyBI,OAAzB,EAAkCI,MAAMnB,MAAxC;AACH,KAPD,EAOG+B,KAPH,CAOSR,OAAO;AACZS,gBAAQC,KAAR,CAAcV,GAAd;AACA,YAAIR,UAAU;AACVH,qBAAS,SADC;AAEVS,qBAASpB,EAFC;AAGVsB,iBAAKA,IAAIW,QAAJ;AAHK,SAAd;AAKAf,cAAMpB,MAAN,CAAaY,WAAb,CAAyBI,OAAzB,EAAkCI,MAAMnB,MAAxC;AACH,KAfD;AAgBH","file":"sandbox.chrome.js","sourcesContent":["'use strict';\n\nrequire('../config/api/zed');\n\nvar source;\nvar origin;\nvar id = 0;\nvar waitingForReply = {};\n\nglobal.sandboxRequest = function(module, call, args) {\n    return new Promise(function(resolve, reject) {\n        id++;\n        waitingForReply[id] = {\n            resolve: resolve,\n            reject: reject\n        };\n        source.postMessage({\n            command: 'api-request',\n            id: id,\n            module: module,\n            call: call,\n            args: args\n        }, origin);\n    });\n};\n\nwindow.addEventListener('message', message => {\n    source = message.source;\n    origin = message.origin;\n    if (message.data.command === 'exec') {\n        exec(message);\n    } else if (message.data.command === 'api-response') {\n        apiResponse(message);\n    }\n});\n\nfunction apiResponse(event) {\n    const data = event.data;\n    var p = waitingForReply[data.replyTo];\n\n    if (undefined !== data.err && null !== data.err) {\n        p.reject(data.err);\n    } else {\n        p.resolve(data.result);\n    }\n    delete waitingForReply[data.replyTo];\n}\n\nasync function exec(event) {\n    const data = event.data;\n    const id = data.id;\n    const url = data.url;\n    \n    if (!url) {\n        return;\n    }\n\n    let fn;\n    \n    if (WEBPACK) {\n        fn = require(`../config${url.slice(0, -3)}.js`);\n    } else {\n        try {\n            fn = require(data.configDir + url);\n        } catch (err) {\n            fn = require('../config' + url);\n        }\n    }\n    \n    if (data.fn) {\n        fn = fn[data.fn];\n    }\n    \n    Promise.resolve(data.data).then(fn).then(result => {\n        var message = {\n            command: 'results',\n            replyTo: id,\n            result: result\n        };\n        event.source.postMessage(message, event.origin);\n    }).catch(err => {\n        console.error(err);\n        var message = {\n            command: 'results',\n            replyTo: id,\n            err: err.toString()\n        };\n        event.source.postMessage(message, event.origin);\n    });\n}"]}