{"version":3,"sources":["../../src/main/ZedWindow.js"],"names":["BrowserWindow","ipcMain","require","path","url","ZedWindow","constructor","zed","readyToClose","title","lastFocus","Date","now","window","width","height","icon","join","__dirname","show","handleEvents","focus","getWebContents","webContents","on","saveBounds","event","quitting","preventDefault","saveAndCleanup","then","close","removeWindow","isFocused","load","projectPath","loadURL","format","pathname","protocol","slashes","query","Promise","resolve","didSaveSession","didDestroySandboxes","didSaveSessionHandler","fromWebContents","sender","removeListener","didDestroySandboxesHandler","send","getBounds","openDevTools","module","exports"],"mappings":"AAAA;;AAEA,MAAM,EAACA,aAAD,EAAgBC,OAAhB,KAA2BC,QAAQ,UAAR,CAAjC;AACA,MAAMC,OAAOD,QAAQ,MAAR,CAAb;AACA,MAAME,MAAMF,QAAQ,KAAR,CAAZ;;AAEA,MAAMG,SAAN,CAAgB;AACZC,gBAAYC,GAAZ,EAAiB;AACb,aAAKA,GAAL,GAAWA,GAAX;AACA,aAAKC,YAAL,GAAoB,KAApB;AACA,aAAKC,KAAL,GAAa,KAAb;AACA,aAAKN,IAAL,GAAY,EAAZ;AACA,aAAKO,SAAL,GAAiBC,KAAKC,GAAL,EAAjB;;AAEA,aAAKC,MAAL,GAAc,IAAIb,aAAJ,CAAkB;AAC5Bc,mBAAO,GADqB;AAE5BC,oBAAQ,GAFoB;AAG5BC,kBAAMb,KAAKc,IAAL,CAAUC,SAAV,EAAqB,IAArB,EAA2B,OAA3B,EAAoC,UAApC,CAHsB;AAI5BC,kBAAM;AAJsB,SAAlB,CAAd;AAMA,aAAKC,YAAL;AACH;;AAEDC,YAAQ;AACJ,aAAKR,MAAL,CAAYQ,KAAZ;AACH;;AAEDC,qBAAiB;AACb,eAAO,KAAKT,MAAL,CAAYU,WAAnB;AACH;;AAEDH,mBAAe;AACX,aAAKP,MAAL,CAAYW,EAAZ,CAAe,MAAf,EAAuB,MAAM;AACzB,iBAAKC,UAAL;AACH,SAFD;;AAIA,aAAKZ,MAAL,CAAYW,EAAZ,CAAe,QAAf,EAAyB,MAAM;AAC3B,iBAAKC,UAAL;AACH,SAFD;;AAIA,aAAKZ,MAAL,CAAYW,EAAZ,CAAe,OAAf,EAAwBE,SAAS;AAC7B,gBAAI,CAAC,KAAKnB,GAAL,CAASoB,QAAV,IAAsB,CAAC,KAAKnB,YAAhC,EAA8C;AAC1C,qBAAKA,YAAL,GAAoB,IAApB;AACAkB,sBAAME,cAAN;AACA,qBAAKC,cAAL,GAAsBC,IAAtB,CAA2B,MAAM;AAC7B,yBAAKjB,MAAL,CAAYkB,KAAZ;AACH,iBAFD;AAGH;AACJ,SARD;;AAUA,aAAKlB,MAAL,CAAYW,EAAZ,CAAe,QAAf,EAAyB,MAAM;AAC3B,iBAAKX,MAAL,GAAc,IAAd;AACA,iBAAKN,GAAL,CAASyB,YAAT,CAAsB,IAAtB;AACH,SAHD;;AAKA,aAAKnB,MAAL,CAAYW,EAAZ,CAAe,OAAf,EAAwB,MAAM;AAC1B,iBAAKd,SAAL,GAAiBC,KAAKC,GAAL,EAAjB;AACH,SAFD;AAGH;;AAEDqB,gBAAY;AACR,eAAO,KAAKpB,MAAL,CAAYoB,SAAZ,EAAP;AACH;;AAEDC,SAAKzB,KAAL,EAAY0B,WAAZ,EAAyB;AACrB,aAAK1B,KAAL,GAAaA,KAAb;AACA,aAAKN,IAAL,GAAYgC,WAAZ;AACA,aAAKtB,MAAL,CAAYuB,OAAZ,CAAoBhC,IAAIiC,MAAJ,CAAW;AAC3BC,sBAAUnC,KAAKc,IAAL,CAAUC,SAAV,EAAqB,IAArB,EAA2B,aAA3B,CADiB;AAE3BqB,sBAAU,OAFiB;AAG3BC,qBAAS,IAHkB;AAI3BC,mBAAO;AACHhC,qBADG;AAEHL,qBAAK+B;AAFF;AAJoB,SAAX,CAApB;AASH;;AAEDN,qBAAiB;AACb,eAAO,IAAIa,OAAJ,CAAYC,WAAW;AAC1B,gBAAIC,iBAAiB,KAArB;AACA,gBAAIC,sBAAsB,KAA1B;;AAEA,kBAAMC,wBAAyBpB,KAAD,IAAW;AACrC,oBAAI1B,cAAc+C,eAAd,CAA8BrB,MAAMsB,MAApC,MAAgD,KAAKnC,MAAzD,EAAiE;AAC7D+B,qCAAiB,IAAjB;AACA3C,4BAAQgD,cAAR,CAAuB,kBAAvB,EAA2CH,qBAA3C;AACA,wBAAID,mBAAJ,EAAyB;AACrBF;AACH;AACJ;AACJ,aARD;AASA1C,oBAAQuB,EAAR,CAAW,kBAAX,EAA+BsB,qBAA/B;;AAEA,kBAAMI,6BAA8BxB,KAAD,IAAW;AAC1C,oBAAI1B,cAAc+C,eAAd,CAA8BrB,MAAMsB,MAApC,MAAgD,KAAKnC,MAAzD,EAAiE;AAC7DgC,0CAAsB,IAAtB;AACA5C,4BAAQgD,cAAR,CAAuB,uBAAvB,EAAgDC,0BAAhD;AACA,wBAAIN,cAAJ,EAAoB;AAChBD;AACH;AACJ;AACJ,aARD;AASA1C,oBAAQuB,EAAR,CAAW,uBAAX,EAAoC0B,0BAApC;;AAEA,iBAAKrC,MAAL,CAAYU,WAAZ,CAAwB4B,IAAxB,CAA6B,cAA7B;AACA,iBAAKtC,MAAL,CAAYU,WAAZ,CAAwB4B,IAAxB,CAA6B,mBAA7B;AACH,SA5BM,CAAP;AA6BH;;AAED1B,iBAAa;AACT,aAAKZ,MAAL,CAAYU,WAAZ,CAAwB4B,IAAxB,CAA6B,aAA7B,EAA4C,KAAKtC,MAAL,CAAYuC,SAAZ,EAA5C;AACH;;AAEDjC,WAAO;AACH,aAAKN,MAAL,CAAYM,IAAZ;;AAEA,aAAKN,MAAL,CAAYU,WAAZ,CAAwB8B,YAAxB;AACH;AAhHW;;AAmHhBC,OAAOC,OAAP,GAAiBlD,SAAjB","file":"ZedWindow.js","sourcesContent":["'use strict';\n\nconst {BrowserWindow, ipcMain} = require('electron');\nconst path = require('path');\nconst url = require('url');\n\nclass ZedWindow {\n    constructor(zed) {\n        this.zed = zed;\n        this.readyToClose = false;\n        this.title = 'Zed';\n        this.path = '';\n        this.lastFocus = Date.now();\n        \n        this.window = new BrowserWindow({\n            width: 800,\n            height: 600,\n            icon: path.join(__dirname, '..', 'icons', 'Icon.png'),\n            show: false\n        });\n        this.handleEvents();\n    }\n    \n    focus() {\n        this.window.focus();\n    }\n    \n    getWebContents() {\n        return this.window.webContents;\n    }\n    \n    handleEvents() {\n        this.window.on('move', () => {\n            this.saveBounds();\n        });\n        \n        this.window.on('resize', () => {\n            this.saveBounds();\n        });\n        \n        this.window.on('close', event => {\n            if (!this.zed.quitting && !this.readyToClose) {\n                this.readyToClose = true;\n                event.preventDefault();\n                this.saveAndCleanup().then(() => {\n                    this.window.close();\n                });\n            }\n        });\n        \n        this.window.on('closed', () => {\n            this.window = null;\n            this.zed.removeWindow(this);\n        });\n        \n        this.window.on('focus', () => {\n            this.lastFocus = Date.now();\n        });\n    }\n    \n    isFocused() {\n        return this.window.isFocused();\n    }\n    \n    load(title, projectPath) {\n        this.title = title;\n        this.path = projectPath;\n        this.window.loadURL(url.format({\n            pathname: path.join(__dirname, '..', 'editor.html'),\n            protocol: 'file:',\n            slashes: true,\n            query: {\n                title,\n                url: projectPath\n            }\n        }));\n    }\n    \n    saveAndCleanup() {\n        return new Promise(resolve => {\n            let didSaveSession = false;\n            let didDestroySandboxes = false;\n            \n            const didSaveSessionHandler = (event) => {\n                if (BrowserWindow.fromWebContents(event.sender) === this.window) {\n                    didSaveSession = true;\n                    ipcMain.removeListener('did-save-session', didSaveSessionHandler);\n                    if (didDestroySandboxes) {\n                        resolve();\n                    }\n                }\n            };\n            ipcMain.on('did-save-session', didSaveSessionHandler);\n            \n            const didDestroySandboxesHandler = (event) => {\n                if (BrowserWindow.fromWebContents(event.sender) === this.window) {\n                    didDestroySandboxes = true;\n                    ipcMain.removeListener('did-destroy-sandboxes', didDestroySandboxesHandler);\n                    if (didSaveSession) {\n                        resolve();\n                    }\n                }\n            };\n            ipcMain.on('did-destroy-sandboxes', didDestroySandboxesHandler);\n            \n            this.window.webContents.send('save-session');\n            this.window.webContents.send('destroy-sandboxes');\n        });\n    }\n    \n    saveBounds() {\n        this.window.webContents.send('save-bounds', this.window.getBounds());\n    }\n    \n    show() {\n        this.window.show();\n        \n        this.window.webContents.openDevTools();\n    }\n}\n\nmodule.exports = ZedWindow;\n"]}